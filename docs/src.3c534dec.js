parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"jftt":[function(require,module,exports) {
var define;
var e;!function(t,s){"object"==typeof exports&&"object"==typeof module?module.exports=s():"function"==typeof e&&e.amd?e([],s):"object"==typeof exports?exports.Ludic=s():t.Ludic=s()}(window,function(){return function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s="./src/main.ts")}({"./src/asset/asset.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t,s,r){this.name=e,this.url=t,this.type=s,this.options=r||{}}load(){}onload(e,t){return()=>{e(this)}}onAssetResolve(e){}onAssetReject(e){}destroy(){this.name=null,this.url=null,this.type=null,this.options=null,this.data=null}}},"./src/asset/assetLoader.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.t={}},"./src/asset/assetManager.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/asset/imageAssetLoader.ts"),n=s("./src/asset/audioAssetLoader.ts");class i{constructor(){this.assets={},this.loadQueue=[],this.promiseQueue=[],this.loaders={},this.addLoader("image",r.default),this.addLoader("audio",n.default)}loadResource(e,t,s,r,n){let i=null;if(!this.assets[e]||n){let n=this.NewAsset(e,t,s,r);null!=n&&(this.loadQueue.push(n),this.loading=!0,i=n.promise.then(this.onAssetResolve.bind(this),this.onAssetReject.bind(this)))}return i}getAsset(e){return this.assets[e]}getImage(e){let t=this.getAsset(e);switch(t.type){case"image":case"rubeImage":return t.data;default:return null}}getData(e){return this.getAsset(e).data}onAssetResolve(e){return this.assets[e.name]=e,e.onAssetResolve(this),e}onAssetReject(){return console.log("rejected: ",arguments),Promise.reject({reason:"onAssetReject"})}isLoading(){return this.loading}update(){if(0==this.loadQueue.length)this.finalPromise||(this.finalPromise=Promise.all(this.promiseQueue).then(()=>{this.finalPromise&&(this.assetsLoaded.apply(this,arguments),this.promiseQueue=[])}));else{this.finalPromise=null;let e=this.loadQueue.shift();this.promiseQueue.push(e.promise),e.load()}}assetsLoaded(){this.onAssetsLoadedCallback&&this.onAssetsLoadedCallback(this),this.loading=!1}setOnAssetsLoadedCallback(e){this.onAssetsLoadedCallback=e}NewAsset(e,t,s,r){s=s||"image";let n=this.loaders[s];return n?n.load(e,t,s,r):null}destroyAsset(e){delete this.assets[e.name],e.destroy()}addLoader(e,t){"string"==typeof e&&(e=[e]),e.forEach(e=>{this.loaders[e]=t})}}t.AssetManager=i,t.default=new i},"./src/asset/audioAsset.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/asset/asset.ts");t.default=class extends r.default{constructor(e,t,s,r){super(e,t,s||"audio",r),this.context=new AudioContext,this.promise=new Promise((e,t)=>{this.request=new XMLHttpRequest,this.request.open("GET",this.url,!0),this.request.responseType="arraybuffer",this.request.onreadystatechange=this.onload(e,t)})}load(){this.request.send()}onload(e,t){return()=>{this.request.readyState==XMLHttpRequest.DONE&&(200==this.request.status?this.context.decodeAudioData(this.request.response,s=>{if(!s)return console.error("AudioAsset: Error decoding file data: "+this.url),void t(this);this.data=s,e(this)},e=>{console.error("AudioAsset: decodeAudioData error",e),t(this)}):console.error("AudioAsset: Request failure: ",this.request.status,this.request.statusText,this.request))}}}},"./src/asset/audioAssetLoader.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/asset/audioAsset.ts");t.default=new class{load(e,t,s,n){return new r.default(e,t,s,n)}}},"./src/asset/imageAsset.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/asset/asset.ts");t.default=class extends r.default{constructor(e,t,s,r){super(e,t,s||"image",r),this.data=new Image,this.promise=new Promise((e,t)=>{this.data.onload=this.onload(e,t)})}load(){this.data.src=this.url}}},"./src/asset/imageAssetLoader.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/asset/imageAsset.ts");t.default=new class{load(e,t,s,n){return new r.default(e,t,s,n)}}},"./src/core/app.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/core/canvas.ts"),n=s("./src/input/manager.ts");class i{constructor(e){if(this.updateFunctions=[],t.Ludic.$instance)return t.Ludic.$instance;const{el:s,plugins:n=[]}=e;t.Ludic.$instance=this,t.Ludic.canvas=new r.default(s),t.Ludic.registerUpdateFunction((e,s)=>t.Ludic.input.update(e,s)),n.forEach(e=>this.install(e)),this.requestAnimationFrame=(()=>window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame)().bind(window),this.animate=this.animate.bind(this)}static registerUpdateFunction(e){this.$instance.updateFunctions.push(e)}start(){t.Ludic.$running=!0,this.lastRunTime=performance.now(),this.requestAnimationFrame(this.animate)}animate(e){this.requestAnimationFrame(this.animate);let t=performance.now(),s=t-this.lastRunTime;this.updateFunctions.forEach(t=>t(e,s)),this.update(e,s),this.lastRunTime=t}update(e,t){}install(e){e(t.Ludic)}}i.input=new n.default,i.$running=!1,t.Ludic=i,t.default=t.Ludic},"./src/core/camera.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/core/canvas.ts"),n=s("./src/utils/vector2.ts"),i={inverseY:!0,inverseX:!1,x:0,y:0,pixelsToMeters:32,width:300,height:150};class o{constructor(...e){this.viewCenterPixel=new n.default(0,0),this.singleWorldPoint=new n.default(0,0),this.singlePixelPoint=new n.default(0,0),this.offset=new n.default(0,0),this.futurePos=new n.default(0,0);let t=Object.assign({},i);if(1===e.length){const s=e[0];"object"==typeof s?s instanceof r.default?(t.width=s.element.width,t.height=s.element.height):t=Object.assign(t,s):"number"==typeof s?t.pixelsToMeters=s:console.warn(`Camera::Unknown single argument '${typeof s}'.`,e)}else if(2===e.length){let[s,r]=e;t.width=s,t.height=r}else if(4===e.length){let[s,r,n,i]=e;t.x=s,t.y=r,t.width=n,t.height=i}else 0===e.length?console.warn("Camera::Initialized without any args.",e):0!==e.length&&console.warn("Camera::Unknown args.",e);this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.inverseX=t.inverseX,this.inverseY=t.inverseY,this.pixelsToMeters=t.pixelsToMeters,this.updateEnvironmentVariables()}update(e){this.setTransform(e)}drawAxes(e){e.save(),e.lineWidth=1/this.pixelsToMeters,e.strokeStyle="rgb(192,0,0)",e.beginPath(),e.moveTo(0,0),e.lineTo(1,0),e.stroke(),e.strokeStyle="rgb(0,192,0)",e.beginPath(),e.moveTo(0,0),e.lineTo(0,1),e.stroke(),e.restore()}drawBounds(e,t="red"){let s=this.getViewportBounds();e.save(),e.strokeStyle=t,e.lineWidth=1/this.pixelsToMeters,e.strokeRect(s.x,s.y,s.w-s.x,s.h-s.y),e.restore()}getWorldPointFromPixelPoint(e){return this.singleWorldPoint.x=this._getWorldPointFromPixelPoint_x(e.x),this.singleWorldPoint.y=this._getWorldPointFromPixelPoint_y(e.y),this.singleWorldPoint}_getWorldPointFromPixelPoint_x(e){return(this.inverseX?this.offset.x-e:e-this.offset.x)/this.pixelsToMeters}_getWorldPointFromPixelPoint_y(e){return(this.inverseY?e-(this.height-this.offset.y):this.height-this.offset.y-e)/this.pixelsToMeters}getPixelPointFromWorldPoint(e){return this.singlePixelPoint.x=this._getPixelPointFromWorldPoint_x(e.x),this.singlePixelPoint.y=this._getPixelPointFromWorldPoint_y(e.y),this.singlePixelPoint}_getPixelPointFromWorldPoint_x(e){return this.inverseX?this.offset.x-e*this.pixelsToMeters:e*this.pixelsToMeters+this.offset.x}_getPixelPointFromWorldPoint_y(e){return this.inverseY?this.height-(e*this.pixelsToMeters+(this.height-this.offset.y)):this.height-(this.height-this.offset.y-e*this.pixelsToMeters)}setViewCenterWorld(e,t,s=0){let r=this.getViewCenterWorld(),i=new n.default;i.x=e.get_x()-r.x,i.y=e.get_y()-r.y,this.moveCenterBy(i,t,s)}centerWorldToCamera(){this.setOffset(this.viewCenterPixel)}centerWorldToTopLeft(){this.setViewCenterWorld(new n.default,!0)}getViewCenterWorld(){return this.getWorldPointFromPixelPoint(this.viewCenterPixel)}moveCenterBy(e,t,s){s=s||(t?1:.25),this.offset.x-=a(s*e.x*this.pixelsToMeters,0),this.offset.y+=a(s*e.y*this.pixelsToMeters,0)}updateEnvironmentVariables(){this.viewCenterPixel.set_x(this.width/2),this.viewCenterPixel.set_y(this.height/2)}getViewCenterPixel(){return this.viewCenterPixel}getViewportBounds(){return{x:this._getWorldPointFromPixelPoint_x(this.x),y:this._getWorldPointFromPixelPoint_y(this.y),w:this._getWorldPointFromPixelPoint_x(this.width),h:this._getWorldPointFromPixelPoint_y(this.height)}}setCameraBounds(...e){if(1===e.length){const{x:t=this.x,y:s=this.y,width:r=this.width,height:n=this.height}=e[0];this.x=t,this.y=s,this.width=r,this.height=n}else if(4===e.length){const[t=this.x,s=this.y,r=this.width,n=this.height]=e;this.x=t,this.y=s,this.width=r,this.height=n}return{x:this.x,y:this.y,width:this.width,height:this.height}}getOffset(){return this.offset}getOffsetX(){return this.offset.x}getOffsetY(){return this.offset.y}setOffset(...e){1===e.length?(this.offset.x=e[0].x||0,this.offset.y=e[0].y||0):2===e.length&&(this.offset.x=e[0],this.offset.y=e[1])}setTransform(e){e.translate(this.getOffsetX(),this.getOffsetY()),e.scale(this.inverseX?-this.pixelsToMeters:this.pixelsToMeters,this.inverseY?-this.pixelsToMeters:this.pixelsToMeters)}resetTransform(e){e.scale(this.inverseX?-1/this.pixelsToMeters:1/this.pixelsToMeters,this.inverseY?-1/this.pixelsToMeters:1/this.pixelsToMeters),e.translate(-this.getOffsetX(),-this.getOffsetY())}isPointInBounds(e,t,s){let r=!1;return s.save(),s.resetTransform(),this._generateViewportRect(s),r=s.isPointInPath(e,t),s.restore(),r}_generateViewportRect(e){let t=this.getViewportBounds();e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.w,t.y),e.lineTo(t.w,t.h),e.lineTo(t.x,t.h),e.closePath()}}function a(e,t=0){let s=1;for(let r=0;r<t;r++)s*=10;return Math.round(e*s)/s}t.Camera=o,t.default=o},"./src/core/canvas.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t="2d"){this.dimension=t,"string"==typeof e?this.element=document.querySelector(e):e instanceof HTMLCanvasElement&&(this.element=e),this.setDimensions()}get context(){return this.getContext()}getContext(e=this.dimension,t={alpha:!1}){return this._context||(this._context=this.element.getContext(e,t))}setDimensions(e=window.innerWidth,t=window.innerHeight){return this.element.width=e,this.element.height=t,{width:e,height:t}}clear(e="white",t=this.context){t.fillStyle=e,t.clearRect(0,0,this.element.width,this.element.height),t.fillRect(0,0,this.element.width,this.element.height)}}t.Canvas=r,t.default=r},"./src/input/gamepad/controller.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/input/manager.ts"),n=s("./src/input/gamepad/maps.ts");const i={},o=function(e,t,s,r,n){return(e-t)/(s-t)*(n-r)+r};class a{constructor({pressed:e=!1,touched:t=!1,value:s=0}={},r){this.pressed=e,this.touched=t,this.value=s,this.last=null!=r?new a(r,null):null}get toggled(){return this.last&&this.last.pressed!==this.pressed}get buttonUp(){return this.toggled&&!this.pressed}get buttonDown(){return this.toggled&&this.pressed}}class l{constructor(){this.start=new a,this.select=new a,this.home=new a,this.left=new a,this.right=new a,this.up=new a,this.down=new a,this.l1=new a,this.l2=new a,this.l3=new a,this.r1=new a,this.r2=new a,this.r3=new a,this.triangle=new a,this.square=new a,this.circle=new a,this.cross=new a,this.extra=new a,this.lx=new a({value:0,pressed:!1,touched:!1}),this.ly=new a({value:0,pressed:!1,touched:!1}),this.rx=new a({value:0,pressed:!1,touched:!1}),this.ry=new a({value:0,pressed:!1,touched:!1})}vibrate(e){if(null!=this.gamepad){if(null!=this.gamepad.vibrationActuator){const t=null!=e.weakMagnitude?e.weakMagnitude:null!=e.value?e.value:void 0,s=null!=e.strongMagnitude?e.strongMagnitude:null!=e.value?e.value:void 0,r=null!=e.type?e.type:this.gamepad.vibrationActuator.type;return this.gamepad.vibrationActuator.playEffect(r,{duration:e.duration,startDelay:e.startDelay,weakMagnitude:t,strongMagnitude:s})}if(null!=this.gamepad.hapticActuators&&this.gamepad.hapticActuators.length){const t=null!=e.value?e.value:null!=e.weakMagnitude?e.weakMagnitude:e.strongMagnitude;let s=this.gamepad.hapticActuators;return null!=e.type&&(s=s.filter(t=>t.type===e.type)),Promise.all(s.map(s=>s.pulse(t,e.duration)))}}}}t.GamepadState=l;t.default=class{constructor(){this.state=new r.InputState(l),window.addEventListener("gamepadconnected",({gamepad:e,...t})=>{let s=navigator.getGamepads()[e.index];console.log(s);let r=this.findMappingForGamepad(e);r?(console.log(`${r.name} connected as controller ${e.index}.`),i[e.index]=r):(console.warn("No mapping found for gamepad at index %d: %s. %d buttons, %d axes.",e.index,e.id,e.buttons.length,e.axes.length),console.log(e))}),window.addEventListener("gamepaddisconnected",({gamepad:e,...t})=>{console.log("Gamepad disconnected: ",e)})}install(e){e.gamepad=this.state}findMappingForGamepad(e){return Object.values(n.default).find(t=>t.test(e))}get gamepads(){return Array.from(navigator.getGamepads()||[])}_parseGamepadState(e,t){const s=new l;if(null!=e){const r=this.findMappingForGamepad(e);s.gamepad=e,r&&(e.buttons.forEach((e,n)=>{const i=r.buttons[n];if(r.buttonAxes&&i in r.buttonAxes)return;let{value:l,touched:h,pressed:d}=e;r.axisButtons&&r.axisButtons.includes(i)&&(l=o(l,0,1,-1,1)),s[i]=new a({pressed:d,value:l,touched:h},t[i])}),e.axes.forEach((n,i)=>{const o=r.axes[i],l=r.sticks[o],h=r.buttonAxes?r.buttonAxes[o]:null,d=null!=h?r.buttons[h]:null,u=r.dpadAxes?r.dpadAxes[o]:null;if(null!=l)s[o]=new a({pressed:!1,touched:!1,value:n},s[o]);else if(null!=h){const r=e.buttons[h];s[d]=new a(r,t[d])}else null!=u&&Object.entries(u).forEach(([e,r])=>{const i=new a({pressed:!1,value:n,touched:!1},t[e]);i.id=e,r==n&&(i.pressed=!0),s[e]=i})}))}return s}update(e,t){this.gamepads.forEach((e,t)=>{this.state.set(t,this._parseGamepadState(e,this.state.get(t)))})}}},"./src/input/gamepad/maps.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r={"ps4-1":{name:"PS4 Controller (Chrome;macOS)",buttons:["cross","circle","square","triangle","l1","r1","l2","r2","extra","start","l3","r3","up","down","left","right","home","select"],axes:["lx","ly","rx","ry"],sticks:{lx:"leftStick",ly:"leftStick",rx:"rightStick",ry:"rightStick"},test(e){let t=navigator.userAgent;return/54c.*5c4/.test(e.id)&&e.axes.length==this.axes.length&&e.buttons.length==this.buttons.length&&t.includes("Chrome")&&t.includes("Mac OS X")}},"ps4-2":{name:"PS4 Controller (Firefox;macOS)",buttons:["square","cross","circle","triangle","l1","r1","l2","r2","extra","start","l3","r3","home","select","up","down","left","right"],axes:["dpadX","dpadY","rx","l2","r2","ry"],sticks:{lx:"leftStick",ly:"leftStick",rx:"rightStick",ry:"rightStick"},buttonAxes:{l2:6,r2:7},dpadAxes:{dpadX:{left:-1,right:1},dpadY:{up:-1,down:1}},test(e){let t=navigator.userAgent;return/54c.*5c4/.test(e.id)&&e.axes.length==this.axes.length&&e.buttons.length==this.buttons.length&&t.includes("Firefox")&&t.includes("Mac OS X")}},"ps4-3":{name:"PS4 Controller (Firefox;Ubuntu)",buttons:["cross","circle","triangle","square","l1","r1","l2","r2","extra","start","home","l3","r3"],axes:["lx","ly","l2","rx","ry","r2","dpadX","dpadY"],sticks:{lx:"leftStick",ly:"leftStick",rx:"rightStick",ry:"rightStick"},buttonAxes:{l2:6,r2:7},dpadAxes:{dpadX:{left:-1,right:1},dpadY:{up:-1,down:1}},test(e){let t=navigator.userAgent;return/54c/.test(e.id)&&e.axes.length==this.axes.length&&e.buttons.length==this.buttons.length&&t.includes("Firefox")&&t.includes("Ubuntu")}},"ps4-4":{name:"PS4 Controller (Chrome;Linux;Wired)",buttons:["cross","circle","square","triangle","l1","r1","l2","r2","extra","start","l3","r3","up","down","left","right","home"],axes:["lx","ly","rx","ry"],sticks:{lx:"leftStick",ly:"leftStick",rx:"rightStick",ry:"rightStick"},test(e){let t=navigator.userAgent;return/054c/.test(e.id)&&e.axes.length==this.axes.length&&e.buttons.length==this.buttons.length&&t.includes("Chrome")&&t.includes("Linux")}},"ps4-5":{name:"PS4 Controller (Chrome;Linux;Wireless)",buttons:["circle","triangle","cross","square","l1","r1","rx","ry","select","start","home","l3","up","down","left","right","r3","extra"],axes:["lx","ly","l2","r2"],axisButtons:["rx","ry"],sticks:{lx:"leftStick",ly:"leftStick"},test(e){let t=navigator.userAgent;return/054c/.test(e.id)&&e.axes.length==this.axes.length&&e.buttons.length==this.buttons.length&&t.includes("Chrome")&&t.includes("Linux")}}};t.default=r},"./src/input/keyboard/controller.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/input/manager.ts");class n{constructor(e=!1){this.down=e}}t.KeyState=n;t.default=class{constructor(){this.state=new r.InputState(n);let e=e=>{const{type:t,key:s,code:r}=e;let n="keydown"===t;this.state.set(s,{down:n}),this.state.set(r,{down:n})};window.addEventListener("keydown",e,!1),window.addEventListener("keyup",e,!1)}install(e){e.keyboard=this.state}}},"./src/input/manager.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InputState=class{constructor(e){this.state={},this._ctor=e}get(e){let t=this.state[e];return null==t&&(t=this.set(e,Reflect.construct(this._ctor,[]))),t}set(e,t){return this.state[e]=t}};class r{constructor(e=[]){this.inputControllers=[],e.forEach(e=>this.addController(e))}addController(e){e.install(this),this.inputControllers.push(e)}update(e,t){this.inputControllers.forEach(s=>{s.update&&s.update(e,t)})}}t.InputManager=r,t.default=r},"./src/input/mouse/controller.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/input/manager.ts");class n{constructor(e=0,t=0,s=!1){this.x=e,this.y=t,this.down=s}}t.MouseState=n;t.default=class{constructor(){this.state=new r.InputState(n),window.addEventListener("mousemove",e=>{const{which:t,x:s,y:r}=e;this.state.set(t,{x:s,y:r,down:!1})},!1),window.addEventListener("mousedown",e=>{const{which:t,x:s,y:r}=e;this.state.set(t,{x:s,y:r,down:!0})},!1),window.addEventListener("mouseup",e=>{const{which:t,x:s,y:r}=e;this.state.set(t,{x:s,y:r,down:!1})},!1)}install(e){e.mouse=this.state}}},"./src/main.ts":function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0});const n=s("./src/core/app.ts");r(s("./src/core/app.ts")),r(s("./src/core/camera.ts")),r(s("./src/core/canvas.ts")),r(s("./src/render/renderer.ts")),r(s("./src/screen/screen.ts")),r(s("./src/screen/screenManager.ts")),r(s("./src/input/manager.ts")),r(s("./src/input/keyboard/controller.ts"));var i=s("./src/input/keyboard/controller.ts");t.KeyboardController=i.default,r(s("./src/input/mouse/controller.ts"));var o=s("./src/input/mouse/controller.ts");t.MouseController=o.default,r(s("./src/input/gamepad/controller.ts"));var a=s("./src/input/gamepad/controller.ts");t.GamepadController=a.default,r(s("./src/reactivity/dep.ts")),r(s("./src/reactivity/lambda.ts")),r(s("./src/reactivity/state.ts")),r(s("./src/asset/asset.ts")),r(s("./src/asset/assetLoader.ts")),r(s("./src/asset/assetManager.ts")),r(s("./src/asset/audioAsset.ts")),r(s("./src/asset/audioAssetLoader.ts")),r(s("./src/asset/imageAsset.ts")),r(s("./src/asset/imageAssetLoader.ts")),r(s("./src/utils/vector2.ts")),t.default=n.Ludic},"./src/reactivity/dep.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r=0;const n=[];t.pushLambda=function(e){n.push(e),i.lambda=e},t.popLambda=function(){n.pop(),i.lambda=n[n.length-1]};class i{constructor(){this.id=r++,this.lambdas=[]}addLambda(e){this.lambdas.push(e)}removeLambda(e){const t=this.lambdas.indexOf(e);t>-1&&this.lambdas.slice(t,1)}depend(){i.lambda&&i.lambda.addDep(this)}notify(){this.lambdas.forEach(e=>e.update())}}t.Dep=i,t.default=i},"./src/reactivity/lambda.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/reactivity/dep.ts");class n{constructor(e,t){this.depIds=new Set,this.newDepIds=new Set,this.deps=[],this.newDeps=[],this.owner=e,this.fn=t,this.compute()}addDep(e){this.newDepIds.has(e.id)||(this.newDepIds.add(e.id),this.newDeps.push(e),this.depIds.has(e.id)||e.addLambda(this))}compute(){r.pushLambda(this),this.value=this.fn.call(this.owner,this.owner),r.popLambda(),this.clean()}clean(){this.deps.forEach(e=>{this.newDepIds.has(e.id)||e.removeLambda(this)});let e=this.depIds;this.depIds=this.newDepIds,this.newDepIds=e,this.newDepIds.clear(),e=this.deps,this.deps=this.newDeps,this.newDeps=e,this.newDeps.length=0}update(){this.compute()}}t.Lambda=n,t.default=n},"./src/reactivity/state.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s("./src/reactivity/dep.ts"),n=Object.getOwnPropertyNames(Object.prototype),i=Object.getOwnPropertyNames(Array.prototype),o=new WeakMap;class a{constructor(e,t={}){const s=new Map,h=e=>{let t=s.get(e);return t||(t=new r.default,s.set(e,t),t)},{exclude:d=[],dep:u}=t,c=new Set(d);Array.isArray(e)?(i.forEach(e=>c.add(e)),e=l.create(e)):n.forEach(e=>c.add(e)),null!=e&&Object.defineProperty(e,"__state__",{value:this,enumerable:!1,configurable:!0,writable:!0});let p=new Proxy(e,{get(e,t){const s=Reflect.get(e,t);if(c.has(t))return s;const n=h(t);return r.default.lambda&&n.depend(),a.create(s,{dep:n})},set(e,t,s){const r=Reflect.get(e,t);if(c.has(t))return Reflect.set(e,t,s);const n=h(t);if(r===s)return!0;const i=Reflect.set(e,t,a.create(s,{dep:n}));return n.notify(),i}});return o.has(p)||null==u||o.set(p,u),p}static create(e,t={}){return"object"!=typeof e||null==e||e.hasOwnProperty("__state__")?e:new a(e,t)}static dep(e){return o.get(e)}}t.State=a,t.default=a;class l extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Object.create(l.prototype))}static create(e){return new l(e)}static notify(e){const t=a.dep(e);t&&t.notify()}push(...e){const t=Array.prototype.push.call(this,...e);return l.notify(this),t}pop(){const e=super.pop();return l.notify(this),e}shift(){const e=super.shift();return l.notify(this),e}unshift(...e){const t=super.unshift(...e);return l.notify(this),t}splice(e,t,...s){const r=super.splice(e,t,...s);return l.notify(this),r}sort(e){const t=super.sort(e);return l.notify(this),t}reverse(){const e=super.reverse();return l.notify(this),e}}},"./src/render/renderer.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t=[]){this.name=e,this.args=t}}t.RenderingContextFunctionComponent=r;class n{constructor(e,t){this.name=e,this.value=t}}t.RenderingContextPropertyComponent=n;t.RenderingContext=class{constructor(){this.$components=[]}static render(e,t){e.$components.forEach(e=>{this.componentIsFunction(e)?t[e.name].apply(t,e.args):this.componentIsProperty(e)&&(t[e.name]=e.value)})}static componentIsFunction(e){return e.hasOwnProperty("args")}static componentIsProperty(e){return e.hasOwnProperty("value")}restore(){this.$components.push(new r("restore"))}save(){this.$components.push(new r("save"))}getTransform(){throw new Error("Method not implemented.")}resetTransform(){throw new Error("Method not implemented.")}rotate(e){throw new Error("Method not implemented.")}scale(e,t){throw new Error("Method not implemented.")}setTransform(e,t,s,r,n,i){throw new Error("Method not implemented.")}transform(e,t,s,r,n,i){throw new Error("Method not implemented.")}translate(e,t){throw new Error("Method not implemented.")}createLinearGradient(e,t,s,r){throw new Error("Method not implemented.")}createPattern(e,t){throw new Error("Method not implemented.")}createRadialGradient(e,t,s,r,n,i){throw new Error("Method not implemented.")}clearRect(e,t,s,r){throw new Error("Method not implemented.")}fillRect(e,t,s,r){throw new Error("Method not implemented.")}strokeRect(e,t,s,n){this.$components.push(new r("strokeRect",[e,t,s,n]))}beginPath(){throw new Error("Method not implemented.")}clip(e,t){throw new Error("Method not implemented.")}fill(e,t){throw new Error("Method not implemented.")}isPointInPath(e,t,s,n){this.$components.push(new r("restore"))}isPointInStroke(e,t,s){throw new Error("Method not implemented.")}stroke(e){throw new Error("Method not implemented.")}drawFocusIfNeeded(e,t){throw new Error("Method not implemented.")}scrollPathIntoView(e){throw new Error("Method not implemented.")}fillText(e,t,s,r){throw new Error("Method not implemented.")}measureText(e){throw new Error("Method not implemented.")}strokeText(e,t,s,r){throw new Error("Method not implemented.")}drawImage(e,t,s,r,n,i,o,a,l){throw new Error("Method not implemented.")}createImageData(e,t){throw new Error("Method not implemented.")}getImageData(e,t,s,r){throw new Error("Method not implemented.")}putImageData(e,t,s,r,n,i,o){throw new Error("Method not implemented.")}set lineWidth(e){this.$components.push(new n("lineWidth",e))}getLineDash(){throw new Error("Method not implemented.")}setLineDash(e){throw new Error("Method not implemented.")}arc(e,t,s,r,n,i){throw new Error("Method not implemented.")}arcTo(e,t,s,r,n){throw new Error("Method not implemented.")}bezierCurveTo(e,t,s,r,n,i){throw new Error("Method not implemented.")}closePath(){throw new Error("Method not implemented.")}ellipse(e,t,s,r,n,i,o,a){throw new Error("Method not implemented.")}lineTo(e,t){throw new Error("Method not implemented.")}moveTo(e,t){throw new Error("Method not implemented.")}quadraticCurveTo(e,t,s,r){throw new Error("Method not implemented.")}rect(e,t,s,r){throw new Error("Method not implemented.")}}},"./src/screen/screen.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e={}){this.options=e}update(e,...t){}finish(e){this._isFinished||(this.onDestroy(),this._finalData=e||{},this._isFinished=!0)}onDestroy(){}onAddedToManager(e,t){}onRemovedFromManager(e){}}t.Screen=r,t.default=r},"./src/screen/screenManager.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r=1;const n=["onScreenAdded","onScreenFinished","onScreensRemoved","onWarnPopScreen"];class i{constructor(){this._listeners=new Proxy([],{get:(e,t)=>(function(e){return n.includes(e)})(t)?(...s)=>{e.forEach(e=>{null!=e[t]&&e[t].call(e,...s)})}:e[t]}),this._stack=[]}getNewId(){return r++}update(e,t,...s){let r=this._stack;if(r.length>0){let e=r[r.length-1];e._isFinished?this._listeners.onScreenFinished(e,this,e._finalData):e.update.apply(e,arguments)}}addScreen(e,t=!1,s){let r=this._stack;if(e.$manager=this,e.$id=this.getNewId(),t){const[e]=this.popScreen();null!=e&&(s=e._finalData)}r.push(e),e.onAddedToManager(this,s),this._listeners.onScreenAdded(e,this,t)}popScreen(){let e=this._stack;if(e.length>0){let t=e.pop();return t.onRemovedFromManager(this),this._listeners.onScreensRemoved([t],this),[t]}return this._listeners.onWarnPopScreen(e,this),[]}popToScreen(e){let t=this._stack;if(!e.hasOwnProperty("$id"))return!1;let s=t.findIndex(t=>t.$id===e.$id);if(-1===s)return!1;{let e=t.splice(s);return e.slice().reverse().forEach(e=>e.onRemovedFromManager(this)),this._listeners.onScreensRemoved(e,this),e}}addScreenEventListener(e){this._listeners.push(e)}}t.ScreenManager=i,t.default=i},"./src/utils/vector2.ts":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e=0,t=0){this.x=e,this.y=t}get_x(){return this.x}get_y(){return this.y}set_x(e){this.x=e}set_y(e){this.y=e}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.magnitude();return e>0&&this.scale(1/e),this}scale(e){return this.x=this.x*e,this.y=this.y*e,this}}t.Vector2=r,t.default=r}})});
},{}],"EaOP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Not=g,exports.createComponentClass=M,exports.createType=x,exports.World=exports.Types=exports.TagComponent=exports.SystemStateComponent=exports.System=exports.Component=void 0;class e{constructor(e){this._systems=[],this._executeSystems=[],this.world=e}registerSystem(e,t){var n=new e(this.world,t);return n.init&&n.init(),n.order=this._systems.length,this._systems.push(n),n.execute&&this._executeSystems.push(n),this.sortSystems(),this}sortSystems(){this._executeSystems.sort((e,t)=>e.priority-t.priority||e.order-t.order)}getSystem(e){return this._systems.find(t=>t instanceof e)}getSystems(){return this._systems}removeSystem(e){var t=this._systems.indexOf(e);~t&&this._systems.splice(t,1)}execute(e,t){this._executeSystems.forEach(n=>{if(n.enabled&&n.initialized){if(n.canExecute()){let s=performance.now();n.execute(e,t),n.executeTime=performance.now()-s}n.clearEvents()}})}stats(){for(var e={numSystems:this._systems.length,systems:{}},t=0;t<this._systems.length;t++){var n=this._systems[t],s=e.systems[n.constructor.name]={queries:{}};for(var o in n.ctx)s.queries[o]=n.ctx[o].stats()}return e}}class t{constructor(){this._listeners={},this.stats={fired:0,handled:0}}addEventListener(e,t){let n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){return void 0!==this._listeners[e]&&-1!==this._listeners[e].indexOf(t)}removeEventListener(e,t){var n=this._listeners[e];if(void 0!==n){var s=n.indexOf(t);-1!==s&&n.splice(s,1)}}dispatchEvent(e,t,n){this.stats.fired++;var s=this._listeners[e];if(void 0!==s)for(var o=s.slice(0),i=0;i<o.length;i++)o[i].call(this,t,n)}resetCounters(){this.stats.fired=this.stats.handled=0}}function n(e){return e.name}function s(e){var t=n(e);return t.charAt(0).toLowerCase()+t.slice(1)}function o(e){for(var t=[],s=0;s<e.length;s++){var o=e[s];if("object"==typeof o){var i="not"===o.operator?"!":o.operator;t.push(i+n(o.Component))}else t.push(n(o))}return t.map(function(e){return e.toLowerCase()}).sort().join("-")}class i{constructor(e,n){if(this.Components=[],this.NotComponents=[],e.forEach(e=>{"object"==typeof e?this.NotComponents.push(e.Component):this.Components.push(e)}),0===this.Components.length)throw new Error("Can't create a query without components");this.entities=[],this.eventDispatcher=new t,this.reactive=!1,this.key=o(e);for(var s=0;s<n._entities.length;s++){var i=n._entities[s];this.match(i)&&(i.queries.push(this),this.entities.push(i))}}addEntity(e){e.queries.push(this),this.entities.push(e),this.eventDispatcher.dispatchEvent(i.prototype.ENTITY_ADDED,e)}removeEntity(e){let t=this.entities.indexOf(e);~t&&(this.entities.splice(t,1),t=e.queries.indexOf(this),e.queries.splice(t,1),this.eventDispatcher.dispatchEvent(i.prototype.ENTITY_REMOVED,e))}match(e){return e.hasAllComponents(this.Components)&&!e.hasAnyComponents(this.NotComponents)}stats(){return{numComponents:this.Components.length,numEntities:this.entities.length}}}i.prototype.ENTITY_ADDED="Query#ENTITY_ADDED",i.prototype.ENTITY_REMOVED="Query#ENTITY_REMOVED",i.prototype.COMPONENT_CHANGED="Query#COMPONENT_CHANGED";var r=0;class a{constructor(e){this._world=e||null,this.id=r++,this._ComponentTypes=[],this._components={},this._componentsToRemove={},this.queries=[],this._ComponentTypesToRemove=[],this.alive=!1}getComponent(e){return this._components[e.name]}getRemovedComponent(e){return this._componentsToRemove[e.name]}getComponents(){return this._components}getComponentsToRemove(){return this._componentsToRemove}getComponentTypes(){return this._ComponentTypes}getMutableComponent(e){for(var t=this._components[e.name],n=0;n<this.queries.length;n++){var s=this.queries[n];s.reactive&&-1!==s.Components.indexOf(e)&&s.eventDispatcher.dispatchEvent(i.prototype.COMPONENT_CHANGED,this,t)}return t}addComponent(e,t){return this._world.entityAddComponent(this,e,t),this}removeComponent(e,t){return this._world.entityRemoveComponent(this,e,t),this}hasComponent(e){return!!~this._ComponentTypes.indexOf(e)}hasRemovedComponent(e){return!!~this._ComponentTypesToRemove.indexOf(e)}hasAllComponents(e){for(var t=0;t<e.length;t++)if(!this.hasComponent(e[t]))return!1;return!0}hasAnyComponents(e){for(var t=0;t<e.length;t++)if(this.hasComponent(e[t]))return!0;return!1}removeAllComponents(e){return this._world.entityRemoveAllComponents(this,e)}reset(){this.id=r++,this._world=null,this._ComponentTypes.length=0,this.queries.length=0,this._components={}}remove(e){return this._world.removeEntity(this,e)}}class h{constructor(e,t){this.freeList=[],this.count=0,this.T=e;var n=null;arguments.length>1&&(n=Array.prototype.slice.call(arguments)).shift(),this.createElement=n?()=>new e(...n):()=>new e,void 0!==t&&this.expand(t)}aquire(){return this.freeList.length<=0&&this.expand(Math.round(.2*this.count)+1),this.freeList.pop()}release(e){e.reset(),this.freeList.push(e)}expand(e){for(var t=0;t<e;t++)this.freeList.push(this.createElement());this.count+=e}totalSize(){return this.count}totalFree(){return this.freeList.length}totalUsed(){return this.count-this.freeList.length}}class p{constructor(e){this._world=e,this._queries={}}onEntityRemoved(e){for(var t in this._queries){var n=this._queries[t];-1!==e.queries.indexOf(n)&&n.removeEntity(e)}}onEntityComponentAdded(e,t){for(var n in this._queries){var s=this._queries[n];~s.NotComponents.indexOf(t)&&~s.entities.indexOf(e)?s.removeEntity(e):~s.Components.indexOf(t)&&s.match(e)&&!~s.entities.indexOf(e)&&s.addEntity(e)}}onEntityComponentRemoved(e,t){for(var n in this._queries){var s=this._queries[n];~s.NotComponents.indexOf(t)&&!~s.entities.indexOf(e)&&s.match(e)?s.addEntity(e):~s.Components.indexOf(t)&&~s.entities.indexOf(e)&&!s.match(e)&&s.removeEntity(e)}}getQuery(e){var t=o(e),n=this._queries[t];return n||(this._queries[t]=n=new i(e,this._world)),n}stats(){var e={};for(var t in this._queries)e[t]=this._queries[t].stats();return e}}class m{}exports.SystemStateComponent=m;class l{constructor(e){this.world=e,this.componentsManager=e.componentsManager,this._entities=[],this._queryManager=new p(this),this.eventDispatcher=new t,this._entityPool=new h(a),this.entitiesWithComponentsToRemove=[],this.entitiesToRemove=[],this.numStateComponents=0}createEntity(){var e=this._entityPool.aquire();return e.alive=!0,e._world=this,this._entities.push(e),this.eventDispatcher.dispatchEvent(c,e),e}entityAddComponent(e,t,n){if(!~e._ComponentTypes.indexOf(t)){e._ComponentTypes.push(t),t.__proto__===m&&this.numStateComponents++;var s=this.world.componentsManager.getComponentsPool(t).aquire();if(e._components[t.name]=s,n)if(s.copy)s.copy(n);else for(var o in n)s[o]=n[o];this._queryManager.onEntityComponentAdded(e,t),this.world.componentsManager.componentAddedToEntity(t),this.eventDispatcher.dispatchEvent(y,e,t)}}entityRemoveComponent(e,t,s){var o=e._ComponentTypes.indexOf(t);if(~o){if(this.eventDispatcher.dispatchEvent(d,e,t),s)this._entityRemoveComponentSync(e,t,o);else{0===e._ComponentTypesToRemove.length&&this.entitiesWithComponentsToRemove.push(e),e._ComponentTypes.splice(o,1),e._ComponentTypesToRemove.push(t);var i=n(t);e._componentsToRemove[i]=e._components[i],delete e._components[i]}this._queryManager.onEntityComponentRemoved(e,t),t.__proto__===m&&(this.numStateComponents--,0!==this.numStateComponents||e.alive||e.remove())}}_entityRemoveComponentSync(e,t,o){e._ComponentTypes.splice(o,1);var i=s(t),r=n(t),a=e._components[r];delete e._components[r],this.componentsManager._componentPool[i].release(a),this.world.componentsManager.componentRemovedFromEntity(t)}entityRemoveAllComponents(e,t){let n=e._ComponentTypes;for(let s=n.length-1;s>=0;s--)n[s].__proto__!==m&&this.entityRemoveComponent(e,n[s],t)}removeEntity(e,t){var n=this._entities.indexOf(e);if(!~n)throw new Error("Tried to remove entity not in list");e.alive=!1,0===this.numStateComponents&&(this.eventDispatcher.dispatchEvent(u,e),this._queryManager.onEntityRemoved(e),!0===t?this._releaseEntity(e,n):this.entitiesToRemove.push(e)),this.entityRemoveAllComponents(e,t)}_releaseEntity(e,t){this._entities.splice(t,1),e._world=null,this._entityPool.release(e)}removeAllEntities(){for(var e=this._entities.length-1;e>=0;e--)this.removeEntity(this._entities[e])}processDeferredRemoval(){for(let n=0;n<this.entitiesToRemove.length;n++){let e=this.entitiesToRemove[n],t=this._entities.indexOf(e);this._releaseEntity(e,t)}this.entitiesToRemove.length=0;for(let i=0;i<this.entitiesWithComponentsToRemove.length;i++){let r=this.entitiesWithComponentsToRemove[i];for(;r._ComponentTypesToRemove.length>0;){let i=r._ComponentTypesToRemove.pop();var e=s(i),t=n(i),o=r._componentsToRemove[t];delete r._componentsToRemove[t],this.componentsManager._componentPool[e].release(o)}}this.entitiesWithComponentsToRemove.length=0}queryComponents(e){return this._queryManager.getQuery(e)}count(){return this._entities.length}stats(){var e={numEntities:this._entities.length,numQueries:Object.keys(this._queryManager._queries).length,queries:this._queryManager.stats(),numComponentPool:Object.keys(this.componentsManager._componentPool).length,componentPool:{},eventDispatcher:this.eventDispatcher.stats};for(var t in this.componentsManager._componentPool){var n=this.componentsManager._componentPool[t];e.componentPool[t]={used:n.totalUsed(),size:n.count}}return e}}const c="EntityManager#ENTITY_CREATE",u="EntityManager#ENTITY_REMOVED",y="EntityManager#COMPONENT_ADDED",d="EntityManager#COMPONENT_REMOVE";class v{constructor(e){this.count=0,this.used=0,this.T=e}aquire(){return this.used++,this.count++,new this.T}release(){this.used--}totalSize(){return this.count}totalFree(){return 1/0}totalUsed(){return this.used}}class _{constructor(){this.Components={},this._componentPool={},this.numComponents={}}registerComponent(e){this.Components[e.name]=e,this.numComponents[e.name]=0}componentAddedToEntity(e){this.numComponents[e.name]?this.numComponents[e.name]++:this.numComponents[e.name]=1}componentRemovedFromEntity(e){this.numComponents[e.name]--}getComponentsPool(e){var t=s(e);return this._componentPool[t]||(e.prototype.reset?this._componentPool[t]=new h(e):(console.warn(`Component '${e.name}' won't benefit from pooling because 'reset' method was not implemeneted.`),this._componentPool[t]=new v(e))),this._componentPool[t]}}class f{constructor(){if(this.componentsManager=new _(this),this.entityManager=new l(this),this.systemManager=new e(this),this.enabled=!0,this.eventQueues={},"undefined"!=typeof CustomEvent){var t=new CustomEvent("ecsy-world-created",{detail:this});window.dispatchEvent(t)}}registerComponent(e){return this.componentsManager.registerComponent(e),this}registerSystem(e,t){return this.systemManager.registerSystem(e,t),this}getSystem(e){return this.systemManager.getSystem(e)}getSystems(){return this.systemManager.getSystems()}execute(e,t){this.enabled&&(this.systemManager.execute(e,t),this.entityManager.processDeferredRemoval())}stop(){this.enabled=!1}play(){this.enabled=!0}createEntity(){return this.entityManager.createEntity()}stats(){var e={entities:this.entityManager.stats(),system:this.systemManager.stats()};console.log(JSON.stringify(e,null,2))}}exports.World=f;class C{canExecute(){if(0===this._mandatoryQueries.length)return!0;for(let e=0;e<this._mandatoryQueries.length;e++){if(0===this._mandatoryQueries[e].entities.length)return!1}return!0}constructor(e,t){if(this.world=e,this.enabled=!0,this._queries={},this.queries={},this.priority=0,this.executeTime=0,t&&t.priority&&(this.priority=t.priority),this._mandatoryQueries=[],this.initialized=!0,this.constructor.queries)for(var n in this.constructor.queries){var s=this.constructor.queries[n],o=s.components;if(!o||0===o.length)throw new Error("'components' attribute can't be empty in a query");var r=this.world.entityManager.queryComponents(o);this._queries[n]=r,!0===s.mandatory&&this._mandatoryQueries.push(r),this.queries[n]={results:r.entities};const e={added:i.prototype.ENTITY_ADDED,removed:i.prototype.ENTITY_REMOVED,changed:i.prototype.COMPONENT_CHANGED};s.listen&&["added","removed","changed"].forEach(t=>{if(s.listen[t]){let o=s.listen[t];if("changed"===t){if(r.reactive=!0,!0===o){let e=this.queries[n][t]=[];r.eventDispatcher.addEventListener(i.prototype.COMPONENT_CHANGED,t=>{-1===e.indexOf(t)&&e.push(t)})}else if(Array.isArray(o)){let e=this.queries[n][t]=[];r.eventDispatcher.addEventListener(i.prototype.COMPONENT_CHANGED,(t,n)=>{-1!==o.indexOf(n.constructor)&&-1===e.indexOf(t)&&e.push(t)})}}else{let s=this.queries[n][t]=[];r.eventDispatcher.addEventListener(e[t],e=>{-1===s.indexOf(e)&&s.push(e)})}}})}}stop(){this.enabled=!1}play(){this.enabled=!0}clearEvents(){for(let t in this.queries){var e=this.queries[t];if(e.added&&(e.added.length=0),e.removed&&(e.removed.length=0),e.changed)if(Array.isArray(e.changed))e.changed.length=0;else for(let t in e.changed)e.changed[t].length=0}}toJSON(){return{name:this.constructor.name,enabled:this.enabled,executeTime:this.executeTime,priority:this.priority,queries:{}}}}function g(e){return{operator:"not",Component:e}}exports.System=C;class E{}exports.Component=E;class T{reset(){}}function x(e){var t=["create","reset","clear"].filter(t=>!e[t]);if(t.length>0)throw new Error(`createType expect type definition to implements the following functions: ${t.join(", ")}`);return e.isType=!0,e}exports.TagComponent=T;var w={};exports.Types=w,w.Number=x({baseType:Number,isSimpleType:!0,create:e=>void 0!==e?e:0,reset:(e,t,n)=>{e[t]=void 0!==n?n:0},clear:(e,t)=>{e[t]=0}}),w.Boolean=x({baseType:Boolean,isSimpleType:!0,create:e=>void 0!==e&&e,reset:(e,t,n)=>{e[t]=void 0!==n&&n},clear:(e,t)=>{e[t]=!1}}),w.String=x({baseType:String,isSimpleType:!0,create:e=>void 0!==e?e:"",reset:(e,t,n)=>{e[t]=void 0!==n?n:""},clear:(e,t)=>{e[t]=""}}),w.Array=x({baseType:Array,create:e=>void 0!==e?e.slice():[],reset:(e,t,n)=>{void 0!==n?e[t]=n.slice():e[t].length=0},clear:(e,t)=>{e[t].length=0},copy:(e,t,n)=>{e[n]=t[n].slice()}});var O={number:w.Number,boolean:w.Boolean,string:w.String};function q(e){return Array.isArray(e)?w.Array:O[typeof e]?O[typeof e]:null}function M(e,t){for(let r in e){e[r].type||(e[r].type=q(e[r].default))}var n=function(){for(let n in e){var t=e[n];let s=t.type;s&&s.isType?this[n]=s.create(t.default):this[n]=t.default}};void 0!==t&&Object.defineProperty(n,"name",{value:t}),n.prototype.schema=e;var s=!0;for(let r in e){var o=e[r];o.type||(o.type=q(o.default)),o.type||(console.warn(`Unknown type definition for attribute '${r}'`),s=!1)}if(s){n.prototype.copy=function(t){for(let n in e)if(t[n]){let s=e[n].type;s.isSimpleType?this[n]=t[n]:s.copy?s.copy(this,t,n):console.warn(`Unknown copy function for attribute '${n}' data type`)}},n.prototype.reset=function(){for(let t in e){let n=e[t],s=n.type;s.reset&&s.reset(this,t,n.default)}},n.prototype.clear=function(){for(let t in e){let n=e[t].type;n.clear&&n.clear(this,t)}};for(let t in e){let s=e[t],o=s.type;n.prototype[t]=s.default,o.reset&&o.reset(n.prototype,t,s.default)}}else for(var i in console.warn("This component can't use pooling because some data types are not registered. Please provide a type created with 'createType'"),e){let t=e[i];n.prototype[i]=t.default}return n}
},{}],"UZy9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TileStateComponent=exports.CubeCoordinateComponent=exports.PreviousCubeComponent=exports.DestinationCubeComponent=exports.HealthComponent=exports.SpeedComponent=exports.SizeComponent=exports.PlayerConfigComponent=exports.EnemyConfigComponent=exports.MapConfigComponent=exports.isEnemyComponent=exports.isCastleComponent=exports.isTileComponent=exports.isTowerComponent=exports.isPlayerComponent=exports.isTowerMenu=exports.TowerTypeComponent=exports.TowerMenuStateComponent=exports.RenderComponent=exports.PositionComponent=exports.MovementComponent=exports.MechComponent=exports.InputFocus=exports.GamepadComponent=exports.FillComponent=exports.PlayerStateComponent=exports.EnemyStateComponent=exports.CameraComponent=void 0;var e=require("@ludic/ludic"),t=require("ecsy");class o extends t.Component{constructor(){super(),this.value=null}}exports.CameraComponent=o;class s extends t.Component{constructor(e,t,o="1",s=.1,n=10,r=1){super(),this.wave=e,this.group=t,this.type=o,this.speed=s,this.health=n,this.color="red",this.size=r}}exports.EnemyStateComponent=s;class n extends t.Component{constructor(){super(),this.boostMultiplier=1.2,this.building=!1,this._speed=.5,this.vibrating=!1}get speed(){return this.boosting?this._speed*this.boostMultiplier:this._speed}}exports.PlayerStateComponent=n;class r extends t.Component{constructor(e){super(),this.fillStyle=e}}exports.FillComponent=r;class p extends t.Component{constructor(){super(),this.index=-1}}exports.GamepadComponent=p;class i extends t.TagComponent{}exports.InputFocus=i;class C extends t.Component{constructor(){super(),this.type=""}}exports.MechComponent=C;class m extends t.Component{constructor(t,o){super(),this.velocity=new e.Vector2,this.accel=new e.Vector2,this.velocity=t,this.accel=o}}exports.MovementComponent=m;class x extends t.Component{constructor(){super(),this.x=0,this.y=0}}exports.PositionComponent=x;class c extends t.Component{constructor(e){super(),this.renderFn=e}}exports.RenderComponent=c;class a extends t.SystemStateComponent{constructor(){super(),this.reset()}reset(){this.index=0}}exports.TowerMenuStateComponent=a;class u{}exports.TowerTypeComponent=u;class l extends t.TagComponent{}exports.isTowerMenu=l;class h extends t.TagComponent{}exports.isPlayerComponent=h;class d extends t.TagComponent{}exports.isTowerComponent=d;class y extends t.TagComponent{}exports.isTileComponent=y;class T extends t.TagComponent{}exports.isCastleComponent=T;class v extends t.TagComponent{}exports.isEnemyComponent=v;class g extends t.Component{constructor(){super()}reset(){this.value=null}}exports.MapConfigComponent=g;class S extends t.Component{constructor(){super(),this.reset()}reset(){this.value=null}}exports.EnemyConfigComponent=S;class M extends t.Component{constructor(){super(),this.reset()}reset(){this.value=null}}exports.PlayerConfigComponent=M;class b extends t.Component{constructor(){super(),this.reset()}reset(){this.value=0}}exports.SizeComponent=b;class w extends t.Component{constructor(){super(),this.reset()}reset(){this.value=0}}exports.SpeedComponent=w;class P extends t.Component{constructor(){super()}reset(){this.value=0}}exports.HealthComponent=P;class f extends t.Component{constructor(){super(),this.reset()}reset(){this.x=0,this.y=0,this.z=0}}exports.DestinationCubeComponent=f;class z extends t.Component{constructor(){super(),this.reset()}reset(){this.x=0,this.y=0,this.z=0}}exports.PreviousCubeComponent=z;class E extends t.Component{constructor(){super(),this.reset()}reset(){this.x=0,this.y=0,this.z=0}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}}exports.CubeCoordinateComponent=E;class F extends t.Component{constructor(){super(),this.reset()}reset(){this.status="inactive",this.playersOn=0}}exports.TileStateComponent=F;
},{"@ludic/ludic":"jftt","ecsy":"EaOP"}],"BY5F":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.add=o,exports.cube_add=s,exports.subtract=i,exports.equal=u,exports.scale=x,exports.rotateLeft=a,exports.rotateRight=c,exports.direction=h,exports.allNeighbors=p,exports.cube_all_neighbors=d,exports.diagonalNeighbor=f,exports.len=y,exports.distance=z,exports.area_from_side_length=b,exports.side_length_from_area=g,exports.offset_to_cube=l,exports.cubeToOffset=_,exports.cube_to_vector2=M,exports.cubeToAxial=w,exports.axialToCube=q,exports.vector2_to_cube=L,exports.cube_round=v,exports.cubeDirections=exports.diagonals=exports.Hex=void 0;var t=require("@ludic/ludic");class e{constructor(t,e,r,n){if(t+e+r!==0)throw"x + y + z needs to = 0";this.x=t,this.y=e,this.z=r,this.q=t,this.r=r,this.sideLength=n}get position(){return M({x:this.x,y:this.y,z:this.z},this.sideLength)}get cubeCoordinate(){return{x:this.x,y:this.y,z:this.z}}get offsetCoordinate(){return _(this.cubeCoordinate)}}exports.Hex=e;const r=[new e(2,-1,-1,0),new e(1,-2,1,0),new e(-1,-1,2,0),new e(-2,1,1,0),new e(-1,2,-1,0),new e(1,1,-2,0)];exports.diagonals=r;const n=[{x:1,y:-1,z:0},{x:1,y:0,z:-1},{x:0,y:1,z:-1},{x:0,y:-1,z:1},{x:-1,y:1,z:0},{x:-1,y:0,z:1}];function o(t,r){return new e(t.x+r.x,t.y+r.y,t.z+r.z,t.sideLength+r.sideLength)}function s(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}}function i(t,r){return new e(t.x-r.x,t.y-r.y,t.z-r.z,t.sideLength-r.sideLength)}function u(t,e){return t.x==e.x&&t.y==e.y&&t.z==e.z}function x(t,r){return new e(t.x*r,t.y*r,t.z*r,t.sideLength*r)}function a(t){return new e(-t.x,-t.y,-t.z,t.sideLength)}function c(t){return new e(-t.x,-t.y,-t.z,t.sideLength)}function h(t){return n[t]}function p(t){return n.map(r=>o(t,new e(r.x,r.y,r.z,0)))}function d(t){return n.map(e=>s(t,e))}function f(t,e){return o(t,r[e])}function y(t){return(Math.abs(t.q)+Math.abs(t.r)+Math.abs(t.s))/2}function z(t,e){return y(i(t,e))}function b(t){return 3*Math.sqrt(3)/2*Math.pow(t,2)}function g(t){return Math.pow(3,.25)*Math.sqrt(t/9*2)}function l(t){var e=t.q,r=t.r-(t.q-(1&t.q))/2;return{x:e,y:-e-r,z:r}}function _(t){return{q:t.x,r:t.z+(t.x-(1&t.x))/2}}function M(e,r){var n=r*(1.5*e.x),o=r*(Math.sqrt(3)/2*e.x+Math.sqrt(3)*e.y);return new t.Vector2(n,o)}function w(t,e,r){return{q:t,r:e,s:-t-e}}function q(t,e){return{x:t,y:e,z:-t-e}}function L(t,e){return v(q(2/3*t.x/e,(-1/3*t.x+Math.sqrt(3)/3*t.y)/e))}function v(t){var e=Math.round(t.x),r=Math.round(t.y),n=Math.round(t.z),o=Math.abs(e-t.x),s=Math.abs(r-t.y),i=Math.abs(n-t.z);return o>s&&o>i?e=-r-n:s>i?r=-e-n:n=-e-r,{x:e,y:r,z:n}}exports.cubeDirections=n;
},{"@ludic/ludic":"jftt"}],"bDkw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@ludic/ludic"),o=require("ecsy"),n=require("../components"),t=require("../utils/Hex");class p extends o.System{execute(o){const p=this.queries.playerConfig.results[0].getComponent(n.PlayerConfigComponent).value,a=this.queries.mapConfig.results[0].getComponent(n.MapConfigComponent).value,s=this.queries.tiles.results[0].getComponent(n.SizeComponent).value,r=s/3;Object.entries(p).forEach(([o,p])=>{let i=new e.Vector2(0,0);if(a.playerSpawnPoints.length>parseInt(o)){let e=a.playerSpawnPoints[parseInt(o)];i=(0,t.cube_to_vector2)({x:e.x,y:e.y,z:e.z},s)}const m=this.world.createEntity();m.addComponent(n.PositionComponent,i),m.addComponent(n.SizeComponent,{value:r}),m.addComponent(n.MovementComponent),m.addComponent(n.CubeCoordinateComponent,(0,t.vector2_to_cube)(i,s)),m.addComponent(n.PlayerStateComponent),m.addComponent(n.isPlayerComponent),m.addComponent(n.GamepadComponent,{index:parseInt(o)}),m.addComponent(n.InputFocus),m.addComponent(n.MechComponent,{type:p})}),this.enabled=!1}}exports.default=p,p.queries={playerConfig:{components:[n.PlayerConfigComponent],mandatory:!0},mapConfig:{components:[n.MapConfigComponent],mandatory:!0},tiles:{components:[n.isTileComponent],mandatory:!0}};
},{"@ludic/ludic":"jftt","ecsy":"EaOP","../components":"UZy9","../utils/Hex":"BY5F"}],"XPTO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=o(require("@ludic/ludic")),t=require("../components"),n=require("ecsy");function o(e){return e&&e.__esModule?e:{default:e}}class r extends n.System{execute(n){const o=e.default.canvas.context;o.save(),this.queries.camera.results[0].getComponent(t.CameraComponent).value.drawAxes(o),this.queries.entities.results.forEach(e=>{o.save(),this.renderPlayer(o,e),o.restore()}),o.restore()}renderPlayer(e,n){const o=n.getComponent(t.PositionComponent),r=n.getComponent(t.SizeComponent).value,s=n.getComponent(t.MechComponent);e.fillStyle=s.type,e.translate(o.x,o.y),e.beginPath(),e.arc(0,0,r,0,2*Math.PI),e.fill()}}exports.default=r,r.queries={entities:{components:[t.PlayerStateComponent]},camera:{components:[t.CameraComponent]}};
},{"@ludic/ludic":"jftt","../components":"UZy9","ecsy":"EaOP"}],"ZFzK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("../components"),t=r(require("@ludic/ludic")),o=require("ecsy"),n=require("../utils/Hex");function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function r(e){if(e&&e.__esModule)return e;var t=a();if(t&&t.has(e))return t.get(e);var o={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var u=n?Object.getOwnPropertyDescriptor(e,r):null;u&&(u.get||u.set)?Object.defineProperty(o,r,u):o[r]=e[r]}}return o.default=e,t&&t.set(e,o),o}class u extends o.System{constructor(){super(...arguments),this.gamepadDeadzone=.3}execute(o){this.queries.players.results.forEach((o,a)=>{const r=o.getMutableComponent(e.PositionComponent),u=o.getMutableComponent(e.SizeComponent).value,p=o.getComponent(e.GamepadComponent),s=3*u,i=o.getComponent(e.CubeCoordinateComponent),d=o.getComponent(e.PlayerStateComponent),l=t.default.input.gamepad.get(p.index);if(r){if(!d.building){const a=new t.Vector2(0,0);l.lx.value>=this.gamepadDeadzone?a.x=l.lx.value:l.lx.value<=-this.gamepadDeadzone&&(a.x=l.lx.value),l.ly.value>=this.gamepadDeadzone?a.y=-l.ly.value:l.ly.value<=-this.gamepadDeadzone&&(a.y=-l.ly.value),l.circle.buttonDown?d.boosting=!0:l.circle.buttonUp&&(d.boosting=!1),a.scale(d.speed),r.x+=a.x,r.y+=a.y;const u=(0,n.vector2_to_cube)(new t.Vector2(r.x,r.y),s);if(u.x!=i.x||u.z!=i.z||u.z!=i.z){let t=o.getMutableComponent(e.CubeCoordinateComponent);t.x=u.x,t.y=u.y,t.z=u.z}}l.cross.buttonUp&&(this.world.createEntity().addComponent(e.InputFocus).addComponent(e.isTowerMenu).addComponent(e.GamepadComponent,p).addComponent(e.PositionComponent,r).addComponent(e.CubeCoordinateComponent,o.getComponent(e.CubeCoordinateComponent)),o.removeComponent(e.InputFocus))}}),this.queries.towerMenusWithoutFocus.added.forEach(t=>{const o=t.getComponent(e.GamepadComponent).index,n=this.queries.playersWithoutFocus.results.find(t=>t.getComponent(e.GamepadComponent).index==o);null!=n&&n.addComponent(e.InputFocus)})}}exports.default=u,u.queries={players:{components:[e.GamepadComponent,e.PositionComponent,e.PlayerStateComponent,e.InputFocus]},playersWithoutFocus:{components:[e.PlayerStateComponent,e.GamepadComponent,(0,o.Not)(e.InputFocus)]},towerMenusWithoutFocus:{components:[e.isTowerMenu,e.GamepadComponent,(0,o.Not)(e.InputFocus)],listen:{added:!0}}};
},{"../components":"UZy9","@ludic/ludic":"jftt","ecsy":"EaOP","../utils/Hex":"BY5F"}],"jUUt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("ecsy"),t=require("../components");class o extends e.System{execute(e){const o=this.queries.map.results[0].getComponent(t.MapConfigComponent).value,n=this.queries.camera.results[0].getComponent(t.CameraComponent).value,a=n.pixelsToMeters,s=(Math.ceil(n.height/a),Math.ceil(n.width/a),this.queries.tiles.results[0].getComponent(t.SizeComponent).value/1.5);o.castles.forEach(e=>{this.world.createEntity().addComponent(t.isCastleComponent).addComponent(t.SizeComponent,{value:s}).addComponent(t.HealthComponent,{value:10}).addComponent(t.CubeCoordinateComponent,e.coords)}),this.enabled=!1}}exports.default=o,o.queries={map:{components:[t.MapConfigComponent],mandatory:!0},camera:{components:[t.CameraComponent],mandatory:!0},tiles:{components:[t.isTileComponent],mandatory:!0}};
},{"ecsy":"EaOP","../components":"UZy9"}],"R2O5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=n(require("@ludic/ludic")),t=require("ecsy"),o=require("../components"),s=require("../utils/Hex");function n(e){return e&&e.__esModule?e:{default:e}}class r extends t.System{execute(t){const s=e.default.canvas.context,n=this.queries.tiles.results[0].getComponent(o.SizeComponent).value;s.save(),this.queries.castles.results.forEach(e=>{s.save(),this.render(s,e,n),s.restore()}),s.restore()}render(e,t,n){const r=t.getComponent(o.SizeComponent).value,l=t.getComponent(o.HealthComponent).value,i=t.getComponent(o.CubeCoordinateComponent),u=(0,s.cube_to_vector2)({x:i.x,y:i.y,z:i.z},n),a=u.x,c=u.y;e.fillStyle="rgba(67, 211, 35, 1)",e.beginPath(),e.moveTo(u.x-r/2,u.y-r/2),e.lineTo(u.x,u.y+r/2),e.lineTo(u.x+r/2,u.y-r/2),e.fill(),e.save(),e.font="1px serif",e.fillStyle="white",e.scale(1,-1),e.fillText(`${l}`,a-.3,.5-c),e.restore()}}exports.default=r,r.queries={castles:{components:[o.isCastleComponent]},tiles:{components:[o.isTileComponent],mandatory:!0}};
},{"@ludic/ludic":"jftt","ecsy":"EaOP","../components":"UZy9","../utils/Hex":"BY5F"}],"FwEM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("ecsy"),o=require("../components");class t extends e.System{execute(e){const t=this.queries.enemies.changed;t.length&&this.queries.castles.results.forEach(e=>{const n=e.getComponent(o.CubeCoordinateComponent);t.forEach(t=>{const s=t.getComponent(o.CubeCoordinateComponent);n.x==s.x&&n.y==s.y&&n.z==s.z&&this.onEnemyContact(e,t)})})}onEnemyContact(e,t){e.getMutableComponent(o.HealthComponent).value--,t.remove()}}exports.default=t,t.queries={enemies:{components:[o.isEnemyComponent,o.CubeCoordinateComponent],listen:{changed:[o.CubeCoordinateComponent]},mandatory:!0},castles:{components:[o.isCastleComponent],mandatory:!0}};
},{"ecsy":"EaOP","../components":"UZy9"}],"UDi2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@ludic/ludic"),n=require("ecsy"),o=require("../components"),t=require("../utils/Hex");class s extends n.System{constructor(){super(...arguments),this.spawns=[1,2,3,4,5]}execute(e,n){this.queries.enemyConfig.results[0].getComponent(o.EnemyConfigComponent).value;const t=this.queries.tiles.results[0].getComponent(o.SizeComponent).value;this.spawns.indexOf(Math.round(n/5e3))>-1&&(this.spawnRandomEnemy(t),this.spawns.splice(0,1))}spawnRandomEnemy(n){let s=new e.Vector2(8*-n,5*n),i=(0,t.vector2_to_cube)(s,n);this.world.createEntity().addComponent(o.PositionComponent,s).addComponent(o.MovementComponent).addComponent(o.SizeComponent,{value:n/4}).addComponent(o.SpeedComponent,{value:.1}).addComponent(o.CubeCoordinateComponent,i).addComponent(o.DestinationCubeComponent,i).addComponent(o.PreviousCubeComponent,i).addComponent(o.isEnemyComponent)}}exports.default=s,s.queries={enemyConfig:{components:[o.EnemyConfigComponent],mandatory:!0},tiles:{components:[o.isTileComponent],mandatory:!0}};
},{"@ludic/ludic":"jftt","ecsy":"EaOP","../components":"UZy9","../utils/Hex":"BY5F"}],"jBqD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=o(require("@ludic/ludic")),t=require("../components"),n=require("ecsy");function o(e){return e&&e.__esModule?e:{default:e}}class s extends n.System{execute(n){const o=e.default.canvas.context;this.queries.camera.results[0].getComponent(t.CameraComponent).value;o.save(),this.queries.enemies.results.forEach(e=>{o.save(),this.render(o,e),o.restore()}),o.restore()}render(e,n){const o=n.getComponent(t.PositionComponent),s=n.getComponent(t.SizeComponent).value;e.fillStyle="red",e.beginPath(),e.arc(o.x+s/2,o.y+s/2,s,0,2*Math.PI),e.fill()}}exports.default=s,s.queries={enemies:{components:[t.isEnemyComponent]},camera:{components:[t.CameraComponent]}};
},{"@ludic/ludic":"jftt","../components":"UZy9","ecsy":"EaOP"}],"faAT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Vector2Normalize=exports.Vector2Distance=void 0;var t=require("@ludic/ludic");const e=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))};exports.Vector2Distance=e;const r=function(e){const r=Math.sqrt(e.x*e.x+e.y*e.y);return new t.Vector2(e.x/r,e.y/r)};exports.Vector2Normalize=r;
},{"@ludic/ludic":"jftt"}],"FEcG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@ludic/ludic"),t=require("ecsy"),o=require("../components"),n=require("../utils/Euclid"),s=require("../utils/Hex");class r extends t.System{constructor(){super(...arguments),this.pathMap=null}getNeighborTiles(e,t){const n=(0,s.cube_all_neighbors)(t);return e.filter(e=>{let t=!1;return n.forEach(n=>{const s=e.getComponent(o.CubeCoordinateComponent);n.x==s.x&&n.y==s.y&&n.z==s.z&&(t=!0)}),t})}cubeToString(e){return""+e.x+e.y+e.z}generatePathMap(e,t){let n=[t];for(this.pathMap=new Map,this.pathMap.set(this.cubeToString(t),null);n.length;){const t=n.shift();this.getNeighborTiles(e,t).forEach(e=>{const s=e.getComponent(o.CubeCoordinateComponent),r={x:s.x,y:s.y,z:s.z};this.pathMap.has(this.cubeToString(r))||(n.push(r),this.pathMap.set(this.cubeToString(r),t))})}return this.pathMap}moveToHexCenter(t,o,s){let r=new e.Vector2(o.position.x-t.x,o.position.y-t.y);return r=(0,n.Vector2Normalize)(r),new e.Vector2(r.x*s,r.y*s)}execute(t){const r=this.queries.enemies.results,i=this.queries.castles.results,a=this.queries.tiles.results,u=i[0].getComponent(o.CubeCoordinateComponent),p={x:u.x,y:u.y,z:u.z};this.pathMap||this.generatePathMap(a,p);const l=a[0].getComponent(o.SizeComponent).value;r.forEach(t=>{const r=t.getComponent(o.SpeedComponent).value;let i=t.getMutableComponent(o.PositionComponent),a=new e.Vector2(i.x,i.y),u=t.getMutableComponent(o.CubeCoordinateComponent),p=t.getMutableComponent(o.DestinationCubeComponent),c=t.getMutableComponent(o.PreviousCubeComponent),h=(0,s.cube_to_vector2)(p,l);if(Math.abs(h.x-a.x)>.05||Math.abs(h.y-a.y)>.05){let t=new e.Vector2(h.x-a.x,h.y-a.y);t=(0,n.Vector2Normalize)(t),t=new e.Vector2(t.x*r,t.y*r),i.x+=t.x,i.y+=t.y;let o=(0,s.vector2_to_cube)(i,l);o.x==u.x&&o.y==u.y&&o.z==u.z||(u.x=o.x,u.y=o.y,u.z=o.z)}else{c.x=p.x,c.y=p.y,c.z=p.z;let e=this.pathMap.get(this.cubeToString(c));e&&(p.x=e.x,p.y=e.y,p.z=e.z)}})}}exports.default=r,r.queries={enemies:{components:[o.isEnemyComponent],mandatory:!0},tiles:{components:[o.isTileComponent],mandatory:!0},castles:{components:[o.isCastleComponent],mandatory:!0}};
},{"@ludic/ludic":"jftt","ecsy":"EaOP","../components":"UZy9","../utils/Euclid":"faAT","../utils/Hex":"BY5F"}],"sAWO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("ecsy"),t=require("../components"),o=require("../utils/Hex");class n extends e.System{execute(e){this.queries.map.results[0].getComponent(t.MapConfigComponent).value;const n=this.queries.camera.results[0].getComponent(t.CameraComponent).value,a=n.pixelsToMeters,r=Math.ceil(n.height/a),s=Math.ceil(n.width/a),i=r*s/250,m=(0,o.side_length_from_area)(i);let p=Math.sqrt(3)*m,l=2*m,d=Math.ceil(s/(.75*l+l))+1,u=Math.ceil(r/p/2);for(let C=-d;C<=d;C++)for(let e=u;e>=-u;e--){const n=(0,o.offset_to_cube)({q:C,r:e});0,this.world.createEntity().addComponent(t.isTileComponent).addComponent(t.TileStateComponent).addComponent(t.SizeComponent,{value:m}).addComponent(t.CubeCoordinateComponent,n)}this.enabled=!1}}exports.default=n,n.queries={map:{components:[t.MapConfigComponent],mandatory:!0},camera:{components:[t.CameraComponent],mandatory:!0}};
},{"ecsy":"EaOP","../components":"UZy9","../utils/Hex":"BY5F"}],"h6wx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=n(require("@ludic/ludic")),t=require("ecsy"),o=require("../components"),s=require("../utils/Hex");function n(e){return e&&e.__esModule?e:{default:e}}class a extends t.System{init(){const{width:t,height:o}=e.default.canvas.element;this.canvas=new OffscreenCanvas(t,o),this.context=this.canvas.getContext("2d",{alpha:!1})}execute(t){this.queries.camera.results[0].getComponent(o.CameraComponent).value;const s=e.default.canvas.context;s.save(),this.queries.tiles.results.forEach(e=>{s.save(),this.renderTile(s,e),s.restore()}),s.restore()}renderTile(t,n){const a=n.getComponent(o.TileStateComponent),i=n.getComponent(o.SizeComponent).value,r=n.getComponent(o.CubeCoordinateComponent),l=(0,s.cube_to_vector2)({x:r.x,y:r.y,z:r.z},i),u=l.x,c=l.y;t.lineWidth=.15,t.fillStyle="#6EB5FF","active"==a.status&&(t.fillStyle="#AFF8DB"),t.strokeStyle="#FFFFFF",t.beginPath(),t.moveTo(u+i*Math.cos(0),c+i*Math.sin(0));for(let e=0;e<7;e++)t.lineTo(u+i*Math.cos(2*e*Math.PI/6),c+i*Math.sin(2*e*Math.PI/6));t.fill(),t.stroke(),e.default.debug&&(t.save(),t.font="1px serif",t.fillStyle="white",t.scale(1,-1),t.fillText(`${r.x}  ${r.y}  ${r.z}`,u-1.5,-c),t.restore())}}exports.default=a,a.queries={tiles:{components:[o.isTileComponent]},camera:{components:[o.CameraComponent],mandatory:!0}};
},{"@ludic/ludic":"jftt","ecsy":"EaOP","../components":"UZy9","../utils/Hex":"BY5F"}],"Va8b":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@ludic/ludic"),t=require("ecsy"),o=require("../components"),n=require("../utils/Hex");class s extends t.System{execute(t){const s=this.queries.players.changed;if(!s.length)return;const r=this.queries.tiles.results,i=r[0].getComponent(o.SizeComponent).value;let a=[];s.forEach(t=>{const s=t.getComponent(o.PositionComponent),r=new e.Vector2(s.x,s.y);a.push((0,n.vector2_to_cube)(r,i))}),r.forEach(e=>{let t=e.getMutableComponent(o.TileStateComponent),n=e.getComponent(o.CubeCoordinateComponent);t.status="inactive",t.playersOn=0,a.forEach(e=>{e.x==n.x&&e.y==n.y&&e.z==n.z&&(t.status="active",t.playersOn++)})})}}exports.default=s,s.queries={players:{components:[o.isPlayerComponent,o.CubeCoordinateComponent],listen:{changed:[o.CubeCoordinateComponent]},mandatory:!0},tiles:{components:[o.TileStateComponent],mandatory:!0}};
},{"@ludic/ludic":"jftt","ecsy":"EaOP","../components":"UZy9","../utils/Hex":"BY5F"}],"WXR9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("@ludic/ludic")),o=require("ecsy"),t=require("../components");function r(e){return e&&e.__esModule?e:{default:e}}class n extends o.System{execute(){const o=e.default.canvas.context;this.queries.towers.results.forEach(e=>{o.save(),this.renderTower(o,e),o.restore()})}renderTower(e,o){const r=o.getComponent(t.PositionComponent),n=o.getComponent(t.TowerTypeComponent).value;e.fillStyle=n,e.fillRect(r.x-1,r.y-.5,2,3)}}exports.default=n,n.queries={towers:{components:[t.isTowerComponent,t.TowerTypeComponent,t.PositionComponent],mandatory:!0}};
},{"@ludic/ludic":"jftt","ecsy":"EaOP","../components":"UZy9"}],"P1HH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isDirective=exports.directive=void 0;const e=new WeakMap,t=t=>(...s)=>{const i=t(...s);return e.set(i,!0),i};exports.directive=t;const s=t=>"function"==typeof t&&e.has(t);exports.isDirective=s;
},{}],"JQ4u":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeNodes=exports.reparentNodes=exports.isCEPolyfill=void 0;const e=void 0!==window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback;exports.isCEPolyfill=e;const o=(e,o,s=null,l=null)=>{for(;o!==s;){const s=o.nextSibling;e.insertBefore(o,l),o=s}};exports.reparentNodes=o;const s=(e,o,s=null)=>{for(;o!==s;){const s=o.nextSibling;e.removeChild(o),o=s}};exports.removeNodes=s;
},{}],"m4zr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.nothing=exports.noChange=void 0;const e={};exports.noChange=e;const o={};exports.nothing=o;
},{}],"kXJ6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lastAttributeNameRegex=exports.createMarker=exports.isTemplatePartActive=exports.Template=exports.boundAttributeSuffix=exports.markerRegex=exports.nodeMarker=exports.marker=void 0;const e=`{{lit-${String(Math.random()).slice(2)}}}`;exports.marker=e;const t=`\x3c!--${e}--\x3e`;exports.nodeMarker=t;const r=new RegExp(`${e}|${t}`);exports.markerRegex=r;const s="$lit$";exports.boundAttributeSuffix=s;class o{constructor(t,o){this.parts=[],this.element=o;const i=[],l=[],p=document.createTreeWalker(o.content,133,null,!1);let c=0,d=-1,u=0;const{strings:f,values:{length:h}}=t;for(;u<h;){const t=p.nextNode();if(null!==t){if(d++,1===t.nodeType){if(t.hasAttributes()){const e=t.attributes,{length:o}=e;let i=0;for(let t=0;t<o;t++)n(e[t].name,s)&&i++;for(;i-- >0;){const e=f[u],o=x.exec(e)[2],n=o.toLowerCase()+s,i=t.getAttribute(n);t.removeAttribute(n);const a=i.split(r);this.parts.push({type:"attribute",index:d,name:o,strings:a}),u+=a.length-1}}"TEMPLATE"===t.tagName&&(l.push(t),p.currentNode=t.content)}else if(3===t.nodeType){const o=t.data;if(o.indexOf(e)>=0){const e=t.parentNode,l=o.split(r),p=l.length-1;for(let r=0;r<p;r++){let o,i=l[r];if(""===i)o=a();else{const e=x.exec(i);null!==e&&n(e[2],s)&&(i=i.slice(0,e.index)+e[1]+e[2].slice(0,-s.length)+e[3]),o=document.createTextNode(i)}e.insertBefore(o,t),this.parts.push({type:"node",index:++d})}""===l[p]?(e.insertBefore(a(),t),i.push(t)):t.data=l[p],u+=p}}else if(8===t.nodeType)if(t.data===e){const e=t.parentNode;null!==t.previousSibling&&d!==c||(d++,e.insertBefore(a(),t)),c=d,this.parts.push({type:"node",index:d}),null===t.nextSibling?t.data="":(i.push(t),d--),u++}else{let r=-1;for(;-1!==(r=t.data.indexOf(e,r+1));)this.parts.push({type:"node",index:-1}),u++}}else p.currentNode=l.pop()}for(const e of i)e.parentNode.removeChild(e)}}exports.Template=o;const n=(e,t)=>{const r=e.length-t.length;return r>=0&&e.slice(r)===t},i=e=>-1!==e.index;exports.isTemplatePartActive=i;const a=()=>document.createComment("");exports.createMarker=a;const x=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=\/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;exports.lastAttributeNameRegex=x;
},{}],"nn5n":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TemplateInstance=void 0;var e=require("./dom.js"),t=require("./template.js");class s{constructor(e,t,s){this.__parts=[],this.template=e,this.processor=t,this.options=s}update(e){let t=0;for(const s of this.__parts)void 0!==s&&s.setValue(e[t]),t++;for(const s of this.__parts)void 0!==s&&s.commit()}_clone(){const s=e.isCEPolyfill?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),o=[],r=this.template.parts,n=document.createTreeWalker(s,133,null,!1);let i,p=0,l=0,a=n.nextNode();for(;p<r.length;)if(i=r[p],(0,t.isTemplatePartActive)(i)){for(;l<i.index;)l++,"TEMPLATE"===a.nodeName&&(o.push(a),n.currentNode=a.content),null===(a=n.nextNode())&&(n.currentNode=o.pop(),a=n.nextNode());if("node"===i.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(a.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(a,i.name,i.strings,this.options));p++}else this.__parts.push(void 0),p++;return e.isCEPolyfill&&(document.adoptNode(s),customElements.upgrade(s)),s}}exports.TemplateInstance=s;
},{"./dom.js":"JQ4u","./template.js":"kXJ6"}],"SM33":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SVGTemplateResult=exports.TemplateResult=void 0;var e=require("./dom.js"),t=require("./template.js");const s=` ${t.marker} `;class r{constructor(e,t,s,r){this.strings=e,this.values=t,this.type=s,this.processor=r}getHTML(){const e=this.strings.length-1;let r="",n=!1;for(let l=0;l<e;l++){const e=this.strings[l],i=e.lastIndexOf("\x3c!--");n=(i>-1||n)&&-1===e.indexOf("--\x3e",i+1);const o=t.lastAttributeNameRegex.exec(e);r+=null===o?e+(n?s:t.nodeMarker):e.substr(0,o.index)+o[1]+o[2]+t.boundAttributeSuffix+o[3]+t.marker}return r+=this.strings[e]}getTemplateElement(){const e=document.createElement("template");return e.innerHTML=this.getHTML(),e}}exports.TemplateResult=r;class n extends r{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const t=super.getTemplateElement(),s=t.content,r=s.firstChild;return s.removeChild(r),(0,e.reparentNodes)(s,r.firstChild),t}}exports.SVGTemplateResult=n;
},{"./dom.js":"JQ4u","./template.js":"kXJ6"}],"PIiJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventPart=exports.PropertyPart=exports.PropertyCommitter=exports.BooleanAttributePart=exports.NodePart=exports.AttributePart=exports.AttributeCommitter=exports.isIterable=exports.isPrimitive=void 0;var t=require("./directive.js"),e=require("./dom.js"),i=require("./part.js"),s=require("./template-instance.js"),n=require("./template-result.js"),r=require("./template.js");const o=t=>null===t||!("object"==typeof t||"function"==typeof t);exports.isPrimitive=o;const a=t=>Array.isArray(t)||!(!t||!t[Symbol.iterator]);exports.isIterable=a;class h{constructor(t,e,i){this.dirty=!0,this.element=t,this.name=e,this.strings=i,this.parts=[];for(let s=0;s<i.length-1;s++)this.parts[s]=this._createPart()}_createPart(){return new l(this)}_getValue(){const t=this.strings,e=t.length-1;let i="";for(let s=0;s<e;s++){i+=t[s];const e=this.parts[s];if(void 0!==e){const t=e.value;if(o(t)||!a(t))i+="string"==typeof t?t:String(t);else for(const e of t)i+="string"==typeof e?e:String(e)}}return i+=t[e]}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}exports.AttributeCommitter=h;class l{constructor(t){this.value=void 0,this.committer=t}setValue(e){e===i.noChange||o(e)&&e===this.value||(this.value=e,(0,t.isDirective)(e)||(this.committer.dirty=!0))}commit(){for(;(0,t.isDirective)(this.value);){const t=this.value;this.value=i.noChange,t(this)}this.value!==i.noChange&&this.committer.commit()}}exports.AttributePart=l;class u{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild((0,r.createMarker)()),this.endNode=t.appendChild((0,r.createMarker)())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=(0,r.createMarker)()),t.__insert(this.endNode=(0,r.createMarker)())}insertAfterPart(t){t.__insert(this.startNode=(0,r.createMarker)()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){for(;(0,t.isDirective)(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=i.noChange,t(this)}const e=this.__pendingValue;e!==i.noChange&&(o(e)?e!==this.value&&this.__commitText(e):e instanceof n.TemplateResult?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):a(e)?this.__commitIterable(e):e===i.nothing?(this.value=i.nothing,this.clear()):this.__commitText(e))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){const e=this.startNode.nextSibling,i="string"==typeof(t=null==t?"":t)?t:String(t);e===this.endNode.previousSibling&&3===e.nodeType?e.data=i:this.__commitNode(document.createTextNode(i)),this.value=t}__commitTemplateResult(t){const e=this.options.templateFactory(t);if(this.value instanceof s.TemplateInstance&&this.value.template===e)this.value.update(t.values);else{const i=new s.TemplateInstance(e,t.processor,this.options),n=i._clone();i.update(t.values),this.__commitNode(n),this.value=i}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const e=this.value;let i,s=0;for(const n of t)void 0===(i=e[s])&&(i=new u(this.options),e.push(i),0===s?i.appendIntoPart(this):i.insertAfterPart(e[s-1])),i.setValue(n),i.commit(),s++;s<e.length&&(e.length=s,this.clear(i&&i.endNode))}clear(t=this.startNode){(0,e.removeNodes)(this.startNode.parentNode,t.nextSibling,this.endNode)}}exports.NodePart=u;class d{constructor(t,e,i){if(this.value=void 0,this.__pendingValue=void 0,2!==i.length||""!==i[0]||""!==i[1])throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=e,this.strings=i}setValue(t){this.__pendingValue=t}commit(){for(;(0,t.isDirective)(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=i.noChange,t(this)}if(this.__pendingValue===i.noChange)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=i.noChange}}exports.BooleanAttributePart=d;class c extends h{constructor(t,e,i){super(t,e,i),this.single=2===i.length&&""===i[0]&&""===i[1]}_createPart(){return new p(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}exports.PropertyCommitter=c;class p extends l{}exports.PropertyPart=p;let _=!1;try{const t={get capture(){return _=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(g){}class m{constructor(t,e,i){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=e,this.eventContext=i,this.__boundHandleEvent=(t=>this.handleEvent(t))}setValue(t){this.__pendingValue=t}commit(){for(;(0,t.isDirective)(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=i.noChange,t(this)}if(this.__pendingValue===i.noChange)return;const e=this.__pendingValue,s=this.value,n=null==e||null!=s&&(e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive),r=null!=e&&(null==s||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),r&&(this.__options=v(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=i.noChange}handleEvent(t){"function"==typeof this.value?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}}exports.EventPart=m;const v=t=>t&&(_?{capture:t.capture,passive:t.passive,once:t.once}:t.capture);
},{"./directive.js":"P1HH","./dom.js":"JQ4u","./part.js":"m4zr","./template-instance.js":"nn5n","./template-result.js":"SM33","./template.js":"kXJ6"}],"mAZn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultTemplateProcessor=exports.DefaultTemplateProcessor=void 0;var e=require("./parts.js");class t{handleAttributeExpressions(t,r,s,o){const a=r[0];if("."===a){return new e.PropertyCommitter(t,r.slice(1),s).parts}return"@"===a?[new e.EventPart(t,r.slice(1),o.eventContext)]:"?"===a?[new e.BooleanAttributePart(t,r.slice(1),s)]:new e.AttributeCommitter(t,r,s).parts}handleTextExpression(t){return new e.NodePart(t)}}exports.DefaultTemplateProcessor=t;const r=new t;exports.defaultTemplateProcessor=r;
},{"./parts.js":"PIiJ"}],"K8aL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.templateFactory=t,exports.templateCaches=void 0;var e=require("./template.js");function t(t){let s=r.get(t.type);void 0===s&&(s={stringsArray:new WeakMap,keyString:new Map},r.set(t.type,s));let n=s.stringsArray.get(t.strings);if(void 0!==n)return n;const a=t.strings.join(e.marker);return void 0===(n=s.keyString.get(a))&&(n=new e.Template(t,t.getTemplateElement()),s.keyString.set(a,n)),s.stringsArray.set(t.strings,n),n}const r=new Map;exports.templateCaches=r;
},{"./template.js":"kXJ6"}],"dvwX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.render=exports.parts=void 0;var e=require("./dom.js"),t=require("./parts.js"),r=require("./template-factory.js");const s=new WeakMap;exports.parts=s;const o=(o,a,p)=>{let d=s.get(a);void 0===d&&((0,e.removeNodes)(a,a.firstChild),s.set(a,d=new t.NodePart(Object.assign({templateFactory:r.templateFactory},p))),d.appendInto(a)),d.setValue(o),d.commit()};exports.render=o;
},{"./dom.js":"JQ4u","./parts.js":"PIiJ","./template-factory.js":"K8aL"}],"KMqM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"DefaultTemplateProcessor",{enumerable:!0,get:function(){return e.DefaultTemplateProcessor}}),Object.defineProperty(exports,"defaultTemplateProcessor",{enumerable:!0,get:function(){return e.defaultTemplateProcessor}}),Object.defineProperty(exports,"SVGTemplateResult",{enumerable:!0,get:function(){return t.SVGTemplateResult}}),Object.defineProperty(exports,"TemplateResult",{enumerable:!0,get:function(){return t.TemplateResult}}),Object.defineProperty(exports,"directive",{enumerable:!0,get:function(){return r.directive}}),Object.defineProperty(exports,"isDirective",{enumerable:!0,get:function(){return r.isDirective}}),Object.defineProperty(exports,"removeNodes",{enumerable:!0,get:function(){return n.removeNodes}}),Object.defineProperty(exports,"reparentNodes",{enumerable:!0,get:function(){return n.reparentNodes}}),Object.defineProperty(exports,"noChange",{enumerable:!0,get:function(){return o.noChange}}),Object.defineProperty(exports,"nothing",{enumerable:!0,get:function(){return o.nothing}}),Object.defineProperty(exports,"AttributeCommitter",{enumerable:!0,get:function(){return i.AttributeCommitter}}),Object.defineProperty(exports,"AttributePart",{enumerable:!0,get:function(){return i.AttributePart}}),Object.defineProperty(exports,"BooleanAttributePart",{enumerable:!0,get:function(){return i.BooleanAttributePart}}),Object.defineProperty(exports,"EventPart",{enumerable:!0,get:function(){return i.EventPart}}),Object.defineProperty(exports,"isIterable",{enumerable:!0,get:function(){return i.isIterable}}),Object.defineProperty(exports,"isPrimitive",{enumerable:!0,get:function(){return i.isPrimitive}}),Object.defineProperty(exports,"NodePart",{enumerable:!0,get:function(){return i.NodePart}}),Object.defineProperty(exports,"PropertyCommitter",{enumerable:!0,get:function(){return i.PropertyCommitter}}),Object.defineProperty(exports,"PropertyPart",{enumerable:!0,get:function(){return i.PropertyPart}}),Object.defineProperty(exports,"parts",{enumerable:!0,get:function(){return u.parts}}),Object.defineProperty(exports,"render",{enumerable:!0,get:function(){return u.render}}),Object.defineProperty(exports,"templateCaches",{enumerable:!0,get:function(){return a.templateCaches}}),Object.defineProperty(exports,"templateFactory",{enumerable:!0,get:function(){return a.templateFactory}}),Object.defineProperty(exports,"TemplateInstance",{enumerable:!0,get:function(){return p.TemplateInstance}}),Object.defineProperty(exports,"createMarker",{enumerable:!0,get:function(){return s.createMarker}}),Object.defineProperty(exports,"isTemplatePartActive",{enumerable:!0,get:function(){return s.isTemplatePartActive}}),Object.defineProperty(exports,"Template",{enumerable:!0,get:function(){return s.Template}}),exports.svg=exports.html=void 0;var e=require("./lib/default-template-processor.js"),t=require("./lib/template-result.js"),r=require("./lib/directive.js"),n=require("./lib/dom.js"),o=require("./lib/part.js"),i=require("./lib/parts.js"),u=require("./lib/render.js"),a=require("./lib/template-factory.js"),p=require("./lib/template-instance.js"),s=require("./lib/template.js");(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.1.2");const l=(r,...n)=>new t.TemplateResult(r,n,"html",e.defaultTemplateProcessor);exports.html=l;const c=(r,...n)=>new t.SVGTemplateResult(r,n,"svg",e.defaultTemplateProcessor);exports.svg=c;
},{"./lib/default-template-processor.js":"mAZn","./lib/template-result.js":"SM33","./lib/directive.js":"P1HH","./lib/dom.js":"JQ4u","./lib/part.js":"m4zr","./lib/parts.js":"PIiJ","./lib/render.js":"dvwX","./lib/template-factory.js":"K8aL","./lib/template-instance.js":"nn5n","./lib/template.js":"kXJ6"}],"oXRc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.styleMap=void 0;var t=require("../lit-html.js");const e=new WeakMap,r=(0,t.directive)(r=>s=>{if(!(s instanceof t.AttributePart)||s instanceof t.PropertyPart||"style"!==s.committer.name||s.committer.parts.length>1)throw new Error("The `styleMap` directive must be used in the style attribute and must be the only part in the attribute.");const{committer:i}=s,{style:n}=i.element;e.has(s)||(n.cssText=i.strings.join(" "));const o=e.get(s);for(const t in o)t in r||(-1===t.indexOf("-")?n[t]=null:n.removeProperty(t));for(const t in r)-1===t.indexOf("-")?n[t]=r[t]:n.setProperty(t,r[t]);e.set(s,r)});exports.styleMap=r;
},{"../lit-html.js":"KMqM"}],"zFN9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.classMap=void 0;var t=require("../lit-html.js");const e=new WeakMap,s=(0,t.directive)(s=>r=>{if(!(r instanceof t.AttributePart)||r instanceof t.PropertyPart||"class"!==r.committer.name||r.committer.parts.length>1)throw new Error("The `classMap` directive must be used in the `class` attribute and must be the only part in the attribute.");const{committer:a}=r,{element:i}=a;e.has(r)||(i.className=a.strings.join(" "));const{classList:o}=i,n=e.get(r);for(const t in n)t in s||o.remove(t);for(const t in s){const e=s[t];if(!n||e!==n[t]){o[e?"add":"remove"](t)}}e.set(r,s)});exports.classMap=s;
},{"../lit-html.js":"KMqM"}],"IXwo":[function(require,module,exports) {

},{}],"OJtE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("ecsy"),t=require("../components"),n=require("@ludic/ludic"),o=require("lit-html"),r=require("lit-html/directives/style-map"),s=require("lit-html/directives/class-map");require("/src/game/ui/styles/towerMenu.styl");class i extends e.System{constructor(){super(...arguments),this.containerId="#tower-menu-render-container",this.towers=[{type:"blue"},{type:"brown"},{type:"green"}]}init(){if(this.container=document.body.querySelector(this.containerId),!this.container){const e=document.body.querySelector("#ui-container");this.container=document.createElement("div"),this.container.id=this.containerId,e.appendChild(this.container)}}execute(){this.queries.added.results.forEach(e=>{e.addComponent(t.TowerMenuStateComponent)}),this.renderMenus()}renderMenus(){const e=this.queries.components.results.map(e=>this.menuTemplate(e));(0,o.render)(o.html`${e}`,this.container)}menuTemplate(e){return o.html`
      <div class=${this.menuClass(e)} style=${this.menuStyle(e)}>
        ${this.towers.map((t,n)=>o.html`
          <div class=${this.towerItemClass(e,n)} data-type=${t.type}>${t.type}</div>
        `)}
      </div>
    `}menuStyle(e){const{value:o}=this.queries.camera.results[0].getComponent(t.CameraComponent),s=e.getComponent(t.PositionComponent),i=o.getPixelPointFromWorldPoint(new n.Vector2(s.x,s.y));return(0,r.styleMap)({left:`${i.x}px`,top:`${i.y-20}px`})}menuClass(e){return(0,s.classMap)({"tower-menu":!0})}towerItemClass(e,n){const o=e.getComponent(t.TowerMenuStateComponent);return(0,s.classMap)({tower:!0,active:o.index==n})}}exports.default=i,i.queries={camera:{components:[t.CameraComponent]},added:{components:[t.isTowerMenu,(0,e.Not)(t.TowerMenuStateComponent)]},components:{components:[t.isTowerMenu,t.InputFocus,t.TowerMenuStateComponent],listen:{added:!0,removed:!0}}};
},{"ecsy":"EaOP","../components":"UZy9","@ludic/ludic":"jftt","lit-html":"KMqM","lit-html/directives/style-map":"oXRc","lit-html/directives/class-map":"zFN9","/src/game/ui/styles/towerMenu.styl":"IXwo"}],"cJx3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("ecsy"),o=require("../components"),t=require("../utils/Hex");class n extends e.System{execute(){this.queries.newTowers.added.forEach(e=>{const{value:n}=e.getComponent(o.TowerTypeComponent);"blue"==n&&this.composeBlueTower(e);const s=e.getComponent(o.CubeCoordinateComponent),r=this.queries.tiles.results.find(e=>e.getComponent(o.CubeCoordinateComponent).equals(s));if(null!=r){const n=r.getComponent(o.SizeComponent).value,i=(0,t.cube_to_vector2)({x:s.x,y:s.y,z:s.z},n);e.addComponent(o.PositionComponent,i)}})}composeBlueTower(e){console.log("create blue tower")}}exports.default=n,n.queries={newTowers:{components:[o.isTowerComponent,o.TowerTypeComponent],mandatory:!0,listen:{added:!0}},tiles:{components:[o.isTileComponent,o.CubeCoordinateComponent]}};
},{"ecsy":"EaOP","../components":"UZy9","../utils/Hex":"BY5F"}],"HKBS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("../components"),t=n(require("@ludic/ludic")),o=require("ecsy");function n(e){return e&&e.__esModule?e:{default:e}}class s extends o.System{constructor(){super(...arguments),this.towers=[{type:"blue"},{type:"brown"},{type:"green"}]}execute(){this.queries.menus.results.forEach(o=>{const n=o.getComponent(e.GamepadComponent),s=t.default.input.gamepad.get(n.index);if(s.circle.buttonUp)this.closeMenu(o);else if(s.left.buttonDown)this.moveLeft(o);else if(s.right.buttonDown)this.moveRight(o);else if(s.cross.buttonUp){const{index:t}=o.getComponent(e.TowerMenuStateComponent),n=o.getComponent(e.CubeCoordinateComponent);this.world.createEntity().addComponent(e.isTowerComponent).addComponent(e.CubeCoordinateComponent,n).addComponent(e.TowerTypeComponent,{value:this.towers[t].type}),this.closeMenu(o)}})}closeMenu(t){t.removeComponent(e.InputFocus)}moveLeft(t){const o=t.getMutableComponent(e.TowerMenuStateComponent);o.index--,o.index<0&&(o.index=this.towers.length-1)}moveRight(t){const o=t.getMutableComponent(e.TowerMenuStateComponent);o.index++,o.index>=this.towers.length&&(o.index=0)}}exports.default=s,s.queries={menus:{components:[e.isTowerMenu,e.GamepadComponent,e.InputFocus,e.TowerMenuStateComponent]}};
},{"../components":"UZy9","@ludic/ludic":"jftt","ecsy":"EaOP"}],"Cb4K":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"PlayerInitSystem",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(exports,"PlayerRenderSystem",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(exports,"PlayerControlSystem",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(exports,"CastleInitSystem",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(exports,"CastleRenderSystem",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(exports,"CastleDamageSystem",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(exports,"EnemySpawnSystem",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(exports,"EnemyRenderSystem",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(exports,"EnemyMovementSystem",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(exports,"TileInitSystem",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(exports,"TileRenderSystem",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(exports,"TileActivationSystem",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(exports,"TowerRenderSystem",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(exports,"TowerMenuRenderSystem",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(exports,"TowerFactorySystem",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(exports,"TowerMenuControlSystem",{enumerable:!0,get:function(){return p.default}});var e=S(require("./PlayerInitSystem")),t=S(require("./PlayerRenderSystem")),r=S(require("./PlayerControlSystem")),n=S(require("./CastleInitSystem")),u=S(require("./CastleRenderSystem")),o=S(require("./CastleDamageSystem")),i=S(require("./EnemySpawnSystem")),y=S(require("./EnemyRenderSystem")),s=S(require("./EnemyMovementSystem")),l=S(require("./TileInitSystem")),m=S(require("./TileRenderSystem")),a=S(require("./TileActivationSystem")),f=S(require("./TowerRenderSystem")),d=S(require("./TowerMenuRenderSystem")),c=S(require("./TowerFactorySystem")),p=S(require("./TowerMenuControlSystem"));function S(e){return e&&e.__esModule?e:{default:e}}
},{"./PlayerInitSystem":"bDkw","./PlayerRenderSystem":"XPTO","./PlayerControlSystem":"ZFzK","./CastleInitSystem":"jUUt","./CastleRenderSystem":"R2O5","./CastleDamageSystem":"FwEM","./EnemySpawnSystem":"UDi2","./EnemyRenderSystem":"jBqD","./EnemyMovementSystem":"FEcG","./TileInitSystem":"sAWO","./TileRenderSystem":"h6wx","./TileActivationSystem":"Va8b","./TowerRenderSystem":"WXR9","./TowerMenuRenderSystem":"OJtE","./TowerFactorySystem":"cJx3","./TowerMenuControlSystem":"HKBS"}],"O5OO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e=[{start:1e3,enemyGroups:[{start:0,type:"1",count:1,spawnInterval:1e3,spawnCoordinate:{x:14,y:0,z:-14}}]},{start:1e4,enemyGroups:[{start:0,type:"2",count:2,spawnInterval:1e3,spawnCoordinate:{x:8,y:3,z:-11}}]},{start:2e4,enemyGroups:[{start:0,type:"1",count:2,spawnInterval:1e3,spawnCoordinate:{x:7,y:1,z:-8}}]}];var t=e;exports.default=t;
},{}],"HCOJ":[function(require,module,exports) {
module.exports={tiles:[{coords:{x:0,y:0,z:0},tileType:"1"},{coords:{x:0,y:1,z:-1},tileType:"1"},{coords:{x:1,y:0,z:-1},tileType:"1"},{coords:{x:1,y:-1,z:0},tileType:"1"},{coords:{x:0,y:-1,z:1},tileType:"1"},{coords:{x:-1,y:0,z:1},tileType:"1"},{coords:{x:-1,y:1,z:0},tileType:"1"},{coords:{x:0,y:2,z:-2},tileType:"1"},{coords:{x:1,y:1,z:-2},tileType:"1"},{coords:{x:2,y:0,z:-2},tileType:"1"},{coords:{x:2,y:-1,z:-1},tileType:"1"},{coords:{x:2,y:-2,z:0},tileType:"1"},{coords:{x:1,y:-2,z:1},tileType:"1"},{coords:{x:0,y:-2,z:2},tileType:"1"},{coords:{x:-1,y:-1,z:2},tileType:"1"},{coords:{x:-2,y:0,z:2},tileType:"1"},{coords:{x:-2,y:1,z:1},tileType:"1"},{coords:{x:-2,y:2,z:0},tileType:"1"},{coords:{x:-1,y:2,z:-1},tileType:"1"}],castles:[{coords:{x:2,y:2,z:-4}}],playerSpawnPoints:[{x:1,y:1,z:-2},{x:3,y:-1,z:2}]};
},{}],"TwIO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("@ludic/ludic")),t=require("../../systems"),i=require("../../components"),s=r(require("./wavesConfig")),n=r(require("./mapConfig"));function r(e){return e&&e.__esModule?e:{default:e}}class y{constructor(t){this.engine=t,e.default.debug=!1}init(e){this.engine.createEntity().addComponent(i.PlayerConfigComponent,{value:e.playerMap}),this.engine.createEntity().addComponent(i.MapConfigComponent,{value:n.default}),this.engine.createEntity().addComponent(i.EnemyConfigComponent,{value:s.default}),this.initSystems()}initSystems(){this.engine.registerSystem(t.TileInitSystem),this.engine.registerSystem(t.CastleInitSystem),this.engine.registerSystem(t.PlayerInitSystem),this.engine.registerSystem(t.EnemySpawnSystem),this.engine.registerSystem(t.TileRenderSystem),this.engine.registerSystem(t.CastleRenderSystem),this.engine.registerSystem(t.EnemyRenderSystem),this.engine.registerSystem(t.TowerRenderSystem),this.engine.registerSystem(t.PlayerRenderSystem),this.engine.registerSystem(t.TowerMenuControlSystem),this.engine.registerSystem(t.PlayerControlSystem),this.engine.registerSystem(t.TowerMenuRenderSystem),this.engine.registerSystem(t.EnemyMovementSystem),this.engine.registerSystem(t.TileActivationSystem),this.engine.registerSystem(t.CastleDamageSystem),this.engine.registerSystem(t.TowerFactorySystem,{priority:1})}}exports.default=y;
},{"@ludic/ludic":"jftt","../../systems":"Cb4K","../../components":"UZy9","./wavesConfig":"O5OO","./mapConfig":"HCOJ"}],"gBJU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=a(require("@ludic/ludic")),t=require("ecsy"),r=require("../components");function a(e){return e&&e.__esModule?e:{default:e}}class u extends t.System{execute(){this.queries.camera.results.forEach(t=>{t.getComponent(r.CameraComponent).value.update(e.default.canvas.context)})}}u.queries={camera:{components:[r.CameraComponent]}};var o=u;exports.default=o;
},{"@ludic/ludic":"jftt","ecsy":"EaOP","../components":"UZy9"}],"wAQi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=o(require("@ludic/ludic")),t=s(require("../levels/level1/level")),r=require("../components"),n=s(require("../systems/CameraRenderSystem")),a=require("ecsy");function s(e){return e&&e.__esModule?e:{default:e}}function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function o(e){if(e&&e.__esModule)return e;var t=i();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var s=n?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}}return r.default=e,t&&t.set(e,r),r}class u extends e.Screen{constructor(){super(),this.engine=new a.World,this.createCamera(),this.level=new t.default(this.engine)}createCamera(){const t=new e.Camera(e.default.canvas);t.offset=new e.Vector2(0,t.height),t.pixelsToMeters=20,this.engine.createEntity().addComponent(r.CameraComponent,{value:t}),t.centerWorldToCamera(),this.engine.registerSystem(n.default)}onAddedToManager(e,t){this.level.init({playerMap:t})}update(t,r){e.default.canvas.context.save(),e.default.canvas.clear(),this.engine.execute(t,r),e.default.canvas.context.restore()}}exports.default=u;
},{"@ludic/ludic":"jftt","../levels/level1/level":"TwIO","../components":"UZy9","../systems/CameraRenderSystem":"gBJU","ecsy":"EaOP"}],"rwBp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=a(require("@ludic/ludic")),r=n(require("./screens/GameScreen"));function n(e){return e&&e.__esModule?e:{default:e}}function t(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return t=function(){return e},e}function a(e){if(e&&e.__esModule)return e;var r=t();if(r&&r.has(e))return r.get(e);var n={};if(null!=e){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var o=a?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(n,u,o):n[u]=e[u]}}return n.default=e,r&&r.set(e,n),n}class u extends e.default{constructor(n){super(n),e.default.input.addController(new e.GamepadController),this.screenManager=new e.ScreenManager,this.screenManager.addScreenEventListener(this),this.screenManager.addScreen(new r.default,!1,{0:"orange",1:"blue",2:"green"})}onScreenFinished(e,r,n){}onScreenAdded(e,r,n){}onScreensRemoved(e,r){}onWarnPopScreen(e,r){}update(e,r){super.update(e,r),this.screenManager.update(r,e)}}exports.default=u;
},{"@ludic/ludic":"jftt","./screens/GameScreen":"wAQi"}],"B6dB":[function(require,module,exports) {
"use strict";var e=r(require("/src/game/game"));function r(e){return e&&e.__esModule?e:{default:e}}new e.default({el:"#game"}).start();
},{"/src/game/game":"rwBp"}]},{},["B6dB"], null)
//# sourceMappingURL=/src.3c534dec.js.map